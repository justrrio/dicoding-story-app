{"version":3,"mappings":"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","names":["instanceOfAny","object","constructors","c","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","promisifyRequest","request","promise","resolve","reject","unlisten","success","error","wrap","value","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","target","prop","receiver","replaceTraps","callback","wrapFunction","func","storeNames","args","unwrap","transformCachableValue","newValue","openDB","name","version","blocked","upgrade","blocking","terminated","openPromise","event","db","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","method","storeName","oldTraps","IndexedDBHelper","story","storyWithTimestamp","a","b","id","favoriteStory","storyData","tempId","offlineStory","storiesCount","favoritesCount","offlineStoriesCount","StoryModel","email","password","data","page","size","location","url","cachedStories","cachedStory","formData","photoBlob","photoBase64","arrayBuffer","base64String","headers","photoError","offlineStories","syncedStories","blob","result","storyId","HomeView","stories","description","maxLength","dateString","options","storyList","e","btn","storyCard","icon","img","isFavorite","message","type","toast","StoryDetailView","isLoading","hasLocation","favoriteBtn","lat","lon","map","AddStoryView","marker","bbox","poly","lng","startCamera","capturePhoto","retryPhoto","form","testNotification","video","startButton","captureButton","stream","canvas","retryButton","track","notification","permission","AuthView","emailInput","passwordInput","nameInput","existingAlert","MapView","s","mapContainer","loadingEl","mapElement","rect","osmLayer","satelliteLayer","darkLayer","baseMaps","markerError","tilesLoaded","FavoritesView","favorites","remainingCards","subtitle","count","text","date","diffTime","diffDays","NotFoundView","notFoundContainer","goHomeBtn","goBackBtn","appContainer","NotificationHelper","registration","subscription","token","subscriptionData","title","defaultOptions","fallbackError","padding","base64","rawData","outputArray","i","registerSW","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","__vitePreload","Workbox","r","HomePresenter","view","model","fullStoryData","basicData","action","pendingActions","offlineAction","StoryDetailPresenter","filteredActions","closeBtn","AddStoryPresenter","notificationError","AuthPresenter","formType","retryCount","maxRetries","formRendered","processResult","loginLink","MapPresenter","storiesWithLocation","FavoritesPresenter","fav","savedActions","processedActions","App","hash","favoritesLink","subError","syncedCount","isOnline","existingIndicator","indicator","updateBanner","offlineBanner","deferredPrompt","installButton","outcome","isError","statusElement"],"ignoreList":[0,1],"sources":["../../node_modules/idb/build/wrap-idb-value.js","../../node_modules/idb/build/index.js","../../src/scripts/indexeddb-helper.js","../../src/models/story-model.js","../../src/views/home-view.js","../../src/views/story-detail-view.js","../../src/views/add-story-view.js","../../src/views/auth-view.js","../../src/views/map-view.js","../../src/views/favorites-view.js","../../src/views/not-found-view.js","../../src/scripts/notification-helper-new.js","../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/presenters/home-presenter.js","../../src/presenters/story-detail-presenter.js","../../src/presenters/add-story-presenter.js","../../src/presenters/auth-presenter.js","../../src/presenters/map-presenter.js","../../src/presenters/favorites-presenter.js","../../src/scripts/app.js"],"sourcesContent":["const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","import { openDB } from \"idb\";\r\n\r\nclass IndexedDBHelper {\r\n  constructor() {\r\n    this.dbName = \"dicoding-story-db\";\r\n    this.version = 1;\r\n    this.db = null;\r\n  }\r\n\r\n  async initDB() {\r\n    try {\r\n      this.db = await openDB(this.dbName, this.version, {\r\n        upgrade(db) {\r\n          // Create stories store\r\n          if (!db.objectStoreNames.contains(\"stories\")) {\r\n            const storyStore = db.createObjectStore(\"stories\", {\r\n              keyPath: \"id\",\r\n            });\r\n            storyStore.createIndex(\"createdAt\", \"createdAt\");\r\n          }\r\n\r\n          // Create favorites store\r\n          if (!db.objectStoreNames.contains(\"favorites\")) {\r\n            const favoriteStore = db.createObjectStore(\"favorites\", {\r\n              keyPath: \"id\",\r\n            });\r\n            favoriteStore.createIndex(\"addedAt\", \"addedAt\");\r\n          }\r\n\r\n          // Create offline-stories store for stories created offline\r\n          if (!db.objectStoreNames.contains(\"offline-stories\")) {\r\n            const offlineStore = db.createObjectStore(\"offline-stories\", {\r\n              keyPath: \"tempId\",\r\n              autoIncrement: true,\r\n            });\r\n            offlineStore.createIndex(\"createdAt\", \"createdAt\");\r\n          }\r\n        },\r\n      });\r\n      console.log(\"IndexedDB initialized successfully\");\r\n    } catch (error) {\r\n      console.error(\"Error initializing IndexedDB:\", error);\r\n    }\r\n  }\r\n\r\n  // Stories operations\r\n  async saveStory(story) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n\r\n      const storyWithTimestamp = {\r\n        ...story,\r\n        savedAt: new Date().toISOString(),\r\n      };\r\n\r\n      await this.db.put(\"stories\", storyWithTimestamp);\r\n      console.log(\"Story saved to IndexedDB:\", story.id);\r\n    } catch (error) {\r\n      console.error(\"Error saving story to IndexedDB:\", error);\r\n    }\r\n  }\r\n  async getAllStories() {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      const stories = await this.db.getAll(\"stories\");\r\n      return stories.sort(\r\n        (a, b) => new Date(b.createdAt) - new Date(a.createdAt)\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Error getting stories from IndexedDB:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async getStoryById(id) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      return await this.db.get(\"stories\", id);\r\n    } catch (error) {\r\n      console.error(\"Error getting story from IndexedDB:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Legacy method names for compatibility\r\n  async getStories() {\r\n    return this.getAllStories();\r\n  }\r\n\r\n  async getStory(id) {\r\n    return this.getStoryById(id);\r\n  }\r\n\r\n  async deleteStory(id) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      await this.db.delete(\"stories\", id);\r\n      console.log(\"Story deleted from IndexedDB:\", id);\r\n    } catch (error) {\r\n      console.error(\"Error deleting story from IndexedDB:\", error);\r\n    }\r\n  }\r\n\r\n  // Favorites operations\r\n  async addToFavorites(story) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n\r\n      const favoriteStory = {\r\n        ...story,\r\n        addedAt: new Date().toISOString(),\r\n      };\r\n\r\n      await this.db.put(\"favorites\", favoriteStory);\r\n      console.log(\"Story added to favorites:\", story.id);\r\n    } catch (error) {\r\n      console.error(\"Error adding to favorites:\", error);\r\n    }\r\n  }\r\n  async getAllFavorites() {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      const favorites = await this.db.getAll(\"favorites\");\r\n      return favorites.sort(\r\n        (a, b) => new Date(b.addedAt) - new Date(a.addedAt)\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Error getting favorites from IndexedDB:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async getFavoriteById(id) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      const favorite = await this.db.get(\"favorites\", id);\r\n      return favorite;\r\n    } catch (error) {\r\n      console.error(\"Error getting favorite by id:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Legacy method names for compatibility\r\n  async getFavorites() {\r\n    return this.getAllFavorites();\r\n  }\r\n\r\n  async removeFromFavorites(id) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      await this.db.delete(\"favorites\", id);\r\n      console.log(\"Story removed from favorites:\", id);\r\n    } catch (error) {\r\n      console.error(\"Error removing from favorites:\", error);\r\n    }\r\n  }\r\n\r\n  async isFavorite(id) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      const favorite = await this.db.get(\"favorites\", id);\r\n      return !!favorite;\r\n    } catch (error) {\r\n      console.error(\"Error checking favorite status:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Offline stories operations\r\n  async saveOfflineStory(storyData) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n\r\n      const tempId = Date.now(); // Use timestamp as tempId\r\n      const offlineStory = {\r\n        tempId: tempId,\r\n        ...storyData,\r\n        createdAt: new Date().toISOString(),\r\n        synced: false,\r\n      };\r\n\r\n      await this.db.add(\"offline-stories\", offlineStory);\r\n      console.log(\"Offline story saved with tempId:\", tempId);\r\n      return tempId;\r\n    } catch (error) {\r\n      console.error(\"Error saving offline story:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async getAllOfflineStories() {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      return await this.db.getAll(\"offline-stories\");\r\n    } catch (error) {\r\n      console.error(\"Error getting offline stories:\", error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Legacy method names for compatibility\r\n  async getOfflineStories() {\r\n    return this.getAllOfflineStories();\r\n  }\r\n\r\n  async deleteOfflineStory(tempId) {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      await this.db.delete(\"offline-stories\", tempId);\r\n      console.log(\"Offline story deleted:\", tempId);\r\n    } catch (error) {\r\n      console.error(\"Error deleting offline story:\", error);\r\n    }\r\n  }\r\n\r\n  // Clear all data\r\n  async clearAllData() {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n      await this.db.clear(\"stories\");\r\n      await this.db.clear(\"favorites\");\r\n      await this.db.clear(\"offline-stories\");\r\n      console.log(\"All IndexedDB data cleared\");\r\n    } catch (error) {\r\n      console.error(\"Error clearing IndexedDB data:\", error);\r\n    }\r\n  }\r\n\r\n  // Get database size info\r\n  async getDBInfo() {\r\n    try {\r\n      if (!this.db) await this.initDB();\r\n\r\n      const storiesCount = await this.db.count(\"stories\");\r\n      const favoritesCount = await this.db.count(\"favorites\");\r\n      const offlineStoriesCount = await this.db.count(\"offline-stories\");\r\n\r\n      return {\r\n        stories: storiesCount,\r\n        favorites: favoritesCount,\r\n        offlineStories: offlineStoriesCount,\r\n        total: storiesCount + favoritesCount + offlineStoriesCount,\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error getting DB info:\", error);\r\n      return { stories: 0, favorites: 0, offlineStories: 0, total: 0 };\r\n    }\r\n  }\r\n}\r\n\r\nexport { IndexedDBHelper };\r\nexport default IndexedDBHelper;\r\n","import { IndexedDBHelper } from \"../scripts/indexeddb-helper.js\";\r\n\r\nclass StoryModel {\r\n  constructor() {\r\n    this.baseUrl = \"https://story-api.dicoding.dev/v1\";\r\n    this.token = localStorage.getItem(\"token\") || null;\r\n    this.dbHelper = new IndexedDBHelper();\r\n  }\r\n  async register(name, email, password) {\r\n    try {\r\n      // Validate input before sending to API\r\n      if (!name || !email || !password) {\r\n        return {\r\n          error: true,\r\n          message: \"Name, email, and password are required\",\r\n        };\r\n      }\r\n\r\n      if (password.length < 8) {\r\n        return {\r\n          error: true,\r\n          message: \"Password must be at least 8 characters long\",\r\n        };\r\n      }\r\n\r\n      const response = await fetch(`${this.baseUrl}/register`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          name,\r\n          email,\r\n          password,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      // Log response for debugging\r\n      if (data.error) {\r\n        console.warn(\"Registration API error:\", data.message);\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      throw new Error(`Failed to register: ${error.message}`);\r\n    }\r\n  }\r\n  async login(email, password) {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/login`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          email,\r\n          password,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!data.error) {\r\n        // Save login data in local storage\r\n        localStorage.setItem(\"token\", data.loginResult.token);\r\n        localStorage.setItem(\"userId\", data.loginResult.userId);\r\n        localStorage.setItem(\"name\", data.loginResult.name);\r\n        this.token = data.loginResult.token;\r\n      } else {\r\n        // Log error details for debugging\r\n        console.warn(\"Login API error:\", data.message);\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      throw new Error(`Failed to login: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"userId\");\r\n    localStorage.removeItem(\"name\");\r\n    this.token = null;\r\n  }\r\n\r\n  isLoggedIn() {\r\n    return !!this.token;\r\n  }\r\n  async getStories(page = 1, size = 10, location = 0) {\r\n    try {\r\n      // Try to get from cache first if offline\r\n      if (!navigator.onLine) {\r\n        const cachedStories = await this.dbHelper.getAllStories();\r\n        return {\r\n          error: false,\r\n          message: \"Stories retrieved from cache\",\r\n          listStory: cachedStories,\r\n        };\r\n      }\r\n\r\n      const url = new URL(`${this.baseUrl}/stories`);\r\n      url.searchParams.append(\"page\", page);\r\n      url.searchParams.append(\"size\", size);\r\n      url.searchParams.append(\"location\", location);\r\n\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          Authorization: `Bearer ${this.token}`,\r\n        },\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      // Cache stories to IndexedDB if successful\r\n      if (data.error === false && data.listStory) {\r\n        for (const story of data.listStory) {\r\n          await this.dbHelper.saveStory(story);\r\n        }\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Error fetching stories:\", error);\r\n\r\n      // Return cached stories if network fails\r\n      const cachedStories = await this.dbHelper.getAllStories();\r\n      if (cachedStories.length > 0) {\r\n        return {\r\n          error: false,\r\n          message: \"Stories retrieved from cache (network error)\",\r\n          listStory: cachedStories,\r\n        };\r\n      }\r\n\r\n      throw new Error(`Failed to fetch stories: ${error.message}`);\r\n    }\r\n  }\r\n  async getStoryDetail(id) {\r\n    try {\r\n      // Try to get from cache first if offline\r\n      if (!navigator.onLine) {\r\n        const cachedStory = await this.dbHelper.getStoryById(id);\r\n        if (cachedStory) {\r\n          return {\r\n            error: false,\r\n            message: \"Story retrieved from cache\",\r\n            story: cachedStory,\r\n          };\r\n        }\r\n      }\r\n\r\n      const response = await fetch(`${this.baseUrl}/stories/${id}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${this.token}`,\r\n        },\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      // Cache story detail if successful\r\n      if (data.error === false && data.story) {\r\n        await this.dbHelper.saveStory(data.story);\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Error fetching story detail:\", error);\r\n\r\n      // Try to get from cache if network fails\r\n      const cachedStory = await this.dbHelper.getStoryById(id);\r\n      if (cachedStory) {\r\n        return {\r\n          error: false,\r\n          message: \"Story retrieved from cache (network error)\",\r\n          story: cachedStory,\r\n        };\r\n      }\r\n\r\n      throw new Error(`Failed to fetch story detail: ${error.message}`);\r\n    }\r\n  }\r\n  async addStory(formData) {\r\n    try {\r\n      // If offline, save to offline store\r\n      if (!navigator.onLine) {\r\n        console.log(\"Offline detected, saving story locally\");\r\n\r\n        // Convert photo blob to base64 for storage\r\n        const photoBlob = formData.get(\"photo\");\r\n        let photoBase64 = null;\r\n\r\n        if (photoBlob && photoBlob instanceof Blob) {\r\n          try {\r\n            const arrayBuffer = await photoBlob.arrayBuffer();\r\n            const base64String = btoa(\r\n              String.fromCharCode(...new Uint8Array(arrayBuffer))\r\n            );\r\n            photoBase64 = `data:${photoBlob.type};base64,${base64String}`;\r\n          } catch (error) {\r\n            console.error(\"Error converting photo to base64:\", error);\r\n          }\r\n        }\r\n\r\n        const storyData = {\r\n          description: formData.get(\"description\"),\r\n          photoBase64: photoBase64, // Store as base64 string\r\n          photoType: photoBlob ? photoBlob.type : \"image/jpeg\",\r\n          lat: formData.get(\"lat\"),\r\n          lon: formData.get(\"lon\"),\r\n          createdAt: new Date().toISOString(),\r\n          userId: localStorage.getItem(\"userId\"),\r\n          userName: localStorage.getItem(\"name\"),\r\n        };\r\n\r\n        const tempId = await this.dbHelper.saveOfflineStory(storyData);\r\n        console.log(\"Story saved offline with tempId:\", tempId);\r\n\r\n        return {\r\n          error: false,\r\n          message: \"Story saved offline. Will sync when online.\",\r\n          offline: true,\r\n          tempId: tempId,\r\n        };\r\n      }\r\n\r\n      const url = this.token\r\n        ? `${this.baseUrl}/stories`\r\n        : `${this.baseUrl}/stories/guest`;\r\n\r\n      const headers = {};\r\n      if (this.token) {\r\n        headers.Authorization = `Bearer ${this.token}`;\r\n      }\r\n\r\n      const response = await fetch(url, {\r\n        method: \"POST\",\r\n        headers,\r\n        body: formData,\r\n      });\r\n\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Error adding story:\", error);\r\n\r\n      // If network error, save offline with base64 conversion\r\n      const photoBlob = formData.get(\"photo\");\r\n      let photoBase64 = null;\r\n\r\n      if (photoBlob && photoBlob instanceof Blob) {\r\n        try {\r\n          const arrayBuffer = await photoBlob.arrayBuffer();\r\n          const base64String = btoa(\r\n            String.fromCharCode(...new Uint8Array(arrayBuffer))\r\n          );\r\n          photoBase64 = `data:${photoBlob.type};base64,${base64String}`;\r\n        } catch (photoError) {\r\n          console.error(\r\n            \"Error converting photo to base64 in catch block:\",\r\n            photoError\r\n          );\r\n        }\r\n      }\r\n\r\n      const storyData = {\r\n        description: formData.get(\"description\"),\r\n        photoBase64: photoBase64, // Store as base64 string\r\n        photoType: photoBlob ? photoBlob.type : \"image/jpeg\",\r\n        lat: formData.get(\"lat\"),\r\n        lon: formData.get(\"lon\"),\r\n        createdAt: new Date().toISOString(),\r\n        userId: localStorage.getItem(\"userId\"),\r\n        userName: localStorage.getItem(\"name\"),\r\n      };\r\n\r\n      const tempId = await this.dbHelper.saveOfflineStory(storyData);\r\n      console.log(\r\n        \"Story saved offline due to network error with tempId:\",\r\n        tempId\r\n      );\r\n\r\n      return {\r\n        error: false,\r\n        message:\r\n          \"Story saved offline due to network error. Will sync when online.\",\r\n        offline: true,\r\n        tempId: tempId,\r\n      };\r\n    }\r\n  }\r\n\r\n  // Sync offline stories when back online\r\n  async syncOfflineStories() {\r\n    try {\r\n      if (!navigator.onLine) return false;\r\n\r\n      const offlineStories = await this.dbHelper.getAllOfflineStories();\r\n      const syncedStories = [];\r\n      for (const story of offlineStories) {\r\n        try {\r\n          console.log(\"Syncing offline story:\", story.description);\r\n\r\n          const formData = new FormData();\r\n          formData.append(\"description\", story.description);\r\n\r\n          // Convert base64 back to blob\r\n          if (story.photoBase64) {\r\n            try {\r\n              const response = await fetch(story.photoBase64);\r\n              const blob = await response.blob();\r\n              formData.append(\"photo\", blob, \"photo.jpg\");\r\n            } catch (photoError) {\r\n              console.error(\"Error converting base64 to blob:\", photoError);\r\n              // Skip this story if photo conversion fails\r\n              continue;\r\n            }\r\n          }\r\n\r\n          if (story.lat) formData.append(\"lat\", story.lat);\r\n          if (story.lon) formData.append(\"lon\", story.lon);\r\n\r\n          const result = await this.addStory(formData);\r\n          if (!result.error && !result.offline) {\r\n            syncedStories.push(story.tempId);\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Error syncing story:\", error);\r\n        }\r\n      }\r\n\r\n      // Remove synced stories from offline store\r\n      for (const tempId of syncedStories) {\r\n        await this.dbHelper.deleteOfflineStory(tempId);\r\n      }\r\n\r\n      return syncedStories.length;\r\n    } catch (error) {\r\n      console.error(\"Error syncing offline stories:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Favorites management\r\n  async addToFavorites(story) {\r\n    return await this.dbHelper.addToFavorites(story);\r\n  }\r\n\r\n  async removeFromFavorites(storyId) {\r\n    return await this.dbHelper.removeFromFavorites(storyId);\r\n  }\r\n\r\n  async getFavorites() {\r\n    return await this.dbHelper.getAllFavorites();\r\n  }\r\n\r\n  async isFavorite(storyId) {\r\n    const favorite = await this.dbHelper.getFavoriteById(storyId);\r\n    return !!favorite;\r\n  }\r\n}\r\n\r\nexport default StoryModel;\r\n","class HomeView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n  }\r\n  render(stories = []) {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <h2><i class=\"fas fa-book-open\"></i> Latest Stories</h2>\r\n        ${\r\n          stories.length === 0\r\n            ? `<div class=\"loading\"><div class=\"spinner\"></div></div>`\r\n            : `<div class=\"story-list\">\r\n              ${stories\r\n                .map((story) => this._createStoryCardTemplate(story))\r\n                .join(\"\")}\r\n            </div>`\r\n        }\r\n      </section>\r\n    `;\r\n\r\n    this._attachEventListeners();\r\n  }\r\n  _createStoryCardTemplate(story) {\r\n    return `\r\n      <article class=\"story-card\" data-story-id=\"${story.id}\">\r\n        <div class=\"story-thumbnail\">\r\n          <img src=\"${story.photoUrl}\" alt=\"Story by ${\r\n      story.name\r\n    }\" loading=\"lazy\">\r\n          <button class=\"favorite-btn\" data-story-id=\"${\r\n            story.id\r\n          }\" title=\"Add to favorites\">\r\n            <i class=\"far fa-heart\" id=\"heart-${story.id}\"></i>\r\n          </button>\r\n        </div>\r\n        <div class=\"story-info\">\r\n          <div class=\"story-header\">\r\n            <div class=\"author-info\">\r\n              <div class=\"author-avatar\">\r\n                <i class=\"fas fa-user-circle\"></i>\r\n              </div>\r\n              <div class=\"author-details\">\r\n                <span class=\"author-name\">${story.name}</span>\r\n                <span class=\"upload-date\">${this._formatDate(\r\n                  story.createdAt\r\n                )}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"story-content\">\r\n            <h3 class=\"story-title\">${this._truncateDescription(\r\n              story.description,\r\n              60\r\n            )}</h3>\r\n            <p class=\"story-description\">${this._truncateDescription(\r\n              story.description,\r\n              120\r\n            )}</p>\r\n          </div>\r\n          <div class=\"story-actions\">\r\n            <a href=\"#/story/${story.id}\" class=\"btn-detail\">\r\n              <i class=\"fas fa-eye\"></i> View Details\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </article>\r\n    `;\r\n  }\r\n\r\n  _truncateDescription(description, maxLength = 100) {\r\n    if (description.length <= maxLength) return description;\r\n    return description.substring(0, maxLength) + \"...\";\r\n  }\r\n\r\n  _formatDate(dateString) {\r\n    const options = { year: \"numeric\", month: \"short\", day: \"numeric\" };\r\n    return new Date(dateString).toLocaleDateString(\"en-US\", options);\r\n  }\r\n  _attachEventListeners() {\r\n    const storyList = document.querySelector(\".story-list\");\r\n    if (storyList) {\r\n      storyList.addEventListener(\"click\", (e) => {\r\n        if (e.target.closest(\".favorite-btn\")) {\r\n          const btn = e.target.closest(\".favorite-btn\");\r\n          const storyId = btn.dataset.storyId;\r\n          this._handleFavoriteToggle(storyId, btn);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  _handleFavoriteToggle(storyId, btn) {\r\n    // Get story data from the card\r\n    const storyCard = btn.closest(\".story-card\");\r\n    const storyData = this._extractStoryDataFromCard(storyCard);\r\n\r\n    // Dispatch custom event to presenter\r\n    const event = new CustomEvent(\"favorite:toggle\", {\r\n      detail: { storyId, storyData },\r\n    });\r\n    document.dispatchEvent(event);\r\n\r\n    // Provide immediate visual feedback\r\n    const icon = btn.querySelector(\"i\");\r\n    btn.classList.add(\"loading\");\r\n    icon.className = \"fas fa-spinner fa-spin\";\r\n  }\r\n\r\n  _extractStoryDataFromCard(storyCard) {\r\n    const storyId = storyCard.dataset.storyId;\r\n    const img = storyCard.querySelector(\"img\");\r\n    const name = storyCard.querySelector(\"h3\").textContent;\r\n    const description = storyCard.querySelector(\"p\").textContent;\r\n\r\n    return {\r\n      id: storyId,\r\n      name: name,\r\n      description: description,\r\n      photoUrl: img.src,\r\n    };\r\n  }\r\n  updateFavoriteButton(storyId, isFavorite) {\r\n    const btn = document.querySelector(\r\n      `[data-story-id=\"${storyId}\"].favorite-btn`\r\n    );\r\n    const icon = document.getElementById(`heart-${storyId}`);\r\n\r\n    if (btn && icon) {\r\n      btn.classList.remove(\"loading\");\r\n      if (isFavorite) {\r\n        icon.className = \"fas fa-heart\";\r\n        btn.classList.add(\"favorited\");\r\n        btn.title = \"Remove from favorites\";\r\n      } else {\r\n        icon.className = \"far fa-heart\";\r\n        btn.classList.remove(\"favorited\");\r\n        btn.title = \"Add to favorites\";\r\n      }\r\n    }\r\n  }\r\n\r\n  showToast(message, type = \"success\") {\r\n    // Create toast notification\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast-${type}`;\r\n    toast.innerHTML = `\r\n      <div class=\"toast-content\">\r\n        <i class=\"fas ${\r\n          type === \"success\" ? \"fa-check-circle\" : \"fa-exclamation-circle\"\r\n        }\"></i>\r\n        <span>${message}</span>\r\n      </div>\r\n    `;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Show toast\r\n    setTimeout(() => toast.classList.add(\"show\"), 100);\r\n\r\n    // Hide and remove toast\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      setTimeout(() => document.body.removeChild(toast), 300);\r\n    }, 3000);\r\n  }\r\n}\r\n\r\nexport default HomeView;\r\n","class StoryDetailView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n  }\r\n\r\n  render(storyData = null, isLoading = true) {\r\n    if (isLoading) {\r\n      this.app.innerHTML = `\r\n        <section class=\"container\">\r\n          <div class=\"loading\"><div class=\"spinner\"></div></div>\r\n        </section>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    if (!storyData || storyData.error) {\r\n      this.app.innerHTML = `\r\n        <section class=\"container\">\r\n          <div class=\"alert alert-danger\">\r\n            <p>Failed to load story. ${\r\n              storyData?.message || \"Please try again later.\"\r\n            }</p>\r\n          </div>\r\n          <a href=\"#/\" class=\"btn\"><i class=\"fas fa-arrow-left\"></i> Back to Home</a>\r\n        </section>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    const { story } = storyData;\r\n    const hasLocation = story.lat !== null && story.lon !== null;\r\n\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"story-detail\">\r\n          <img src=\"${story.photoUrl}\" alt=\"Photo by ${\r\n      story.name\r\n    }\" class=\"story-detail-image\">          <div class=\"story-detail-content\">\r\n            <div class=\"story-detail-header\">\r\n              <h2>${story.name}</h2>\r\n              <button class=\"favorite-btn btn-icon\" data-story-id=\"${\r\n                story.id\r\n              }\" title=\"Toggle favorite\">\r\n                <i class=\"far fa-heart\" id=\"favorite-icon-${story.id}\"></i>\r\n              </button>\r\n            </div>\r\n            <p class=\"story-meta\"><i class=\"far fa-clock\"></i> ${this._formatDate(\r\n              story.createdAt\r\n            )}</p>\r\n            <p>${story.description}</p>\r\n            ${\r\n              hasLocation\r\n                ? `\r\n              <div class=\"map-container\">\r\n                <div id=\"mapid\"></div>\r\n              </div>\r\n            `\r\n                : \"\"\r\n            }\r\n          </div>\r\n          <a href=\"#/\" class=\"btn\"><i class=\"fas fa-arrow-left\"></i> Back to Home</a>\r\n        </div>\r\n      </section>\r\n    `;\r\n    if (hasLocation) {\r\n      this._initializeMap(story.lat, story.lon, story.name);\r\n    }\r\n\r\n    // Set up favorite button event listener\r\n    this._setupFavoriteButton(story);\r\n  }\r\n\r\n  _setupFavoriteButton(story) {\r\n    const favoriteBtn = document.querySelector(`[data-story-id=\"${story.id}\"]`);\r\n    if (favoriteBtn) {\r\n      favoriteBtn.addEventListener(\"click\", (e) => {\r\n        e.preventDefault();\r\n        const event = new CustomEvent(\"favorite:toggle\", {\r\n          detail: {\r\n            storyId: story.id,\r\n            storyData: story,\r\n          },\r\n        });\r\n        document.dispatchEvent(event);\r\n      });\r\n    }\r\n  }\r\n\r\n  updateFavoriteButton(storyId, isFavorite) {\r\n    const icon = document.getElementById(`favorite-icon-${storyId}`);\r\n    const btn = document.querySelector(`[data-story-id=\"${storyId}\"]`);\r\n\r\n    if (icon && btn) {\r\n      if (isFavorite) {\r\n        icon.className = \"fas fa-heart\";\r\n        btn.classList.add(\"active\");\r\n        btn.title = \"Remove from favorites\";\r\n      } else {\r\n        icon.className = \"far fa-heart\";\r\n        btn.classList.remove(\"active\");\r\n        btn.title = \"Add to favorites\";\r\n      }\r\n    }\r\n  }\r\n\r\n  showToast(message, type = \"success\") {\r\n    // Create toast notification\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast-${type}`;\r\n    toast.innerHTML = `\r\n      <div class=\"toast-content\">\r\n        <i class=\"fas ${\r\n          type === \"success\" ? \"fa-check-circle\" : \"fa-exclamation-circle\"\r\n        }\"></i>\r\n        <span>${message}</span>\r\n      </div>\r\n    `;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Show toast\r\n    setTimeout(() => toast.classList.add(\"show\"), 100);\r\n\r\n    // Hide and remove toast\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      setTimeout(() => document.body.removeChild(toast), 300);\r\n    }, 3000);\r\n  }\r\n\r\n  _formatDate(dateString) {\r\n    const options = {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    };\r\n    return new Date(dateString).toLocaleDateString(\"en-US\", options);\r\n  }\r\n\r\n  _initializeMap(lat, lon, name) {\r\n    setTimeout(() => {\r\n      const map = L.map(\"mapid\").setView([lat, lon], 13);\r\n\r\n      L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n        attribution:\r\n          '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n      }).addTo(map);\r\n\r\n      L.marker([lat, lon])\r\n        .addTo(map)\r\n        .bindPopup(`<b>${name}'s Story Location</b>`)\r\n        .openPopup();\r\n    }, 100);\r\n  }\r\n}\r\n\r\nexport default StoryDetailView;\r\n","class AddStoryView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n    this.stream = null;\r\n  }\r\n\r\n  render() {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"form-container\">\r\n          <h2><i class=\"fas fa-plus-circle\"></i> Add New Story</h2>\r\n          <form id=\"add-story-form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"description\">Description</label>\r\n              <textarea id=\"description\" class=\"form-control\" rows=\"3\" required></textarea>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label>Take a Photo</label>\r\n              <div class=\"camera-container\">\r\n                <div class=\"camera-preview\">\r\n                  <video id=\"camera-preview\" autoplay></video>\r\n                  <canvas id=\"canvas\" style=\"display: none;\"></canvas>\r\n                </div>\r\n                <div class=\"camera-buttons\">\r\n                  <button type=\"button\" class=\"btn\" id=\"start-camera\"><i class=\"fas fa-camera\"></i> Start Camera</button>\r\n                  <button type=\"button\" class=\"btn\" id=\"capture-photo\" style=\"display: none;\"><i class=\"fas fa-camera-retro\"></i> Capture</button>\r\n                  <button type=\"button\" class=\"btn\" id=\"retry-photo\" style=\"display: none;\"><i class=\"fas fa-redo\"></i> Retry</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label>Select Location</label>\r\n              <div class=\"map-container\">\r\n                <div id=\"mapid\"></div>\r\n              </div>\r\n              <p class=\"form-text\">Click on the map to select a location</p>\r\n              <input type=\"hidden\" id=\"lat\" name=\"lat\">\r\n              <input type=\"hidden\" id=\"lon\" name=\"lon\">\r\n              <div id=\"selected-location\" class=\"selected-location\"></div>\r\n            </div>\r\n            <button type=\"submit\" class=\"btn btn-block\" id=\"submit-story\">Submit Story</button>\r\n            <button type=\"button\" class=\"btn btn-secondary btn-block\" id=\"test-notification\" style=\"margin-top: 10px;\">Test Notification</button>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    `;\r\n\r\n    this._initializeMap();\r\n    this._attachEventListeners();\r\n  }\r\n\r\n  _initializeMap() {\r\n    setTimeout(() => {\r\n      const map = L.map(\"mapid\").setView([-6.2, 106.816], 13);\r\n      let marker;\r\n\r\n      L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n        attribution:\r\n          '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n      }).addTo(map);\r\n\r\n      // Add Geocoder\r\n      const geocoder = L.Control.geocoder({\r\n        defaultMarkGeocode: false,\r\n      })\r\n        .on(\"markgeocode\", function (e) {\r\n          const bbox = e.geocode.bbox;\r\n          const poly = L.polygon([\r\n            bbox.getSouthEast(),\r\n            bbox.getNorthEast(),\r\n            bbox.getNorthWest(),\r\n            bbox.getSouthWest(),\r\n          ]).addTo(map);\r\n          map.fitBounds(poly.getBounds());\r\n        })\r\n        .addTo(map);\r\n\r\n      map.on(\"click\", (e) => {\r\n        const { lat, lng } = e.latlng;\r\n\r\n        // Update hidden inputs\r\n        document.getElementById(\"lat\").value = lat;\r\n        document.getElementById(\"lon\").value = lng;\r\n        document.getElementById(\"selected-location\").innerHTML = `\r\n          <p><strong>Selected Location:</strong> Lat: ${lat.toFixed(\r\n            6\r\n          )}, Long: ${lng.toFixed(6)}</p>\r\n        `;\r\n\r\n        // Add or update marker\r\n        if (marker) {\r\n          marker.setLatLng([lat, lng]);\r\n        } else {\r\n          marker = L.marker([lat, lng]).addTo(map);\r\n        }\r\n\r\n        marker.bindPopup(\"Your story location\").openPopup();\r\n      });\r\n\r\n      // Store map instance to access it later\r\n      this.map = map;\r\n    }, 100);\r\n  }\r\n  _attachEventListeners() {\r\n    const startCamera = document.getElementById(\"start-camera\");\r\n    const capturePhoto = document.getElementById(\"capture-photo\");\r\n    const retryPhoto = document.getElementById(\"retry-photo\");\r\n    const form = document.getElementById(\"add-story-form\");\r\n    const testNotification = document.getElementById(\"test-notification\");\r\n\r\n    startCamera.addEventListener(\"click\", () => this._startCamera());\r\n    capturePhoto.addEventListener(\"click\", () => this._capturePhoto());\r\n    retryPhoto.addEventListener(\"click\", () => this._retryPhoto());\r\n    form.addEventListener(\"submit\", (e) => this._handleSubmit(e));\r\n    testNotification.addEventListener(\"click\", () => this._testNotification());\r\n  }\r\n\r\n  _startCamera() {\r\n    const video = document.getElementById(\"camera-preview\");\r\n    const startButton = document.getElementById(\"start-camera\");\r\n    const captureButton = document.getElementById(\"capture-photo\");\r\n\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: true })\r\n      .then((stream) => {\r\n        this.stream = stream;\r\n        video.srcObject = stream;\r\n        startButton.style.display = \"none\";\r\n        captureButton.style.display = \"block\";\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error accessing camera:\", error);\r\n        alert(\r\n          \"Error accessing camera. Please make sure your camera is enabled and try again.\"\r\n        );\r\n      });\r\n  }\r\n\r\n  _capturePhoto() {\r\n    const video = document.getElementById(\"camera-preview\");\r\n    const canvas = document.getElementById(\"canvas\");\r\n    const captureButton = document.getElementById(\"capture-photo\");\r\n    const retryButton = document.getElementById(\"retry-photo\");\r\n\r\n    // Set canvas dimensions to match video dimensions\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n\r\n    // Draw the current video frame to the canvas\r\n    canvas.getContext(\"2d\").drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n    // Stop the video stream\r\n    if (this.stream) {\r\n      this.stream.getTracks().forEach((track) => track.stop());\r\n    }\r\n\r\n    // Hide video and show canvas with captured image\r\n    video.style.display = \"none\";\r\n    canvas.style.display = \"block\";\r\n\r\n    // Change buttons\r\n    captureButton.style.display = \"none\";\r\n    retryButton.style.display = \"block\";\r\n  }\r\n\r\n  _retryPhoto() {\r\n    const video = document.getElementById(\"camera-preview\");\r\n    const canvas = document.getElementById(\"canvas\");\r\n    const captureButton = document.getElementById(\"capture-photo\");\r\n    const retryButton = document.getElementById(\"retry-photo\");\r\n\r\n    // Clear canvas and hide it\r\n    canvas.getContext(\"2d\").clearRect(0, 0, canvas.width, canvas.height);\r\n    canvas.style.display = \"none\";\r\n\r\n    // Show video again\r\n    video.style.display = \"block\";\r\n\r\n    // Restart camera\r\n    this._startCamera();\r\n\r\n    // Change buttons\r\n    retryButton.style.display = \"none\";\r\n    captureButton.style.display = \"block\";\r\n  }\r\n\r\n  _handleSubmit(e) {\r\n    e.preventDefault();\r\n\r\n    // Get form data\r\n    const description = document.getElementById(\"description\").value;\r\n    const canvas = document.getElementById(\"canvas\");\r\n    const lat = document.getElementById(\"lat\").value;\r\n    const lon = document.getElementById(\"lon\").value;\r\n\r\n    // Check if photo is taken\r\n    if (canvas.style.display === \"none\") {\r\n      alert(\"Please take a photo before submitting.\");\r\n      return;\r\n    }\r\n\r\n    // Convert canvas to blob\r\n    canvas.toBlob((blob) => {\r\n      const formData = new FormData();\r\n      formData.append(\"description\", description);\r\n      formData.append(\"photo\", blob, \"photo.jpg\");\r\n\r\n      if (lat && lon) {\r\n        formData.append(\"lat\", lat);\r\n        formData.append(\"lon\", lon);\r\n      }\r\n\r\n      // Dispatch custom event with form data\r\n      const event = new CustomEvent(\"story:submit\", {\r\n        detail: { formData },\r\n      });\r\n      document.dispatchEvent(event);\r\n    }, \"image/jpeg\");\r\n  }\r\n  showSubmitResult(result) {\r\n    console.log(\"showSubmitResult called with:\", result);\r\n    const form = document.getElementById(\"add-story-form\");\r\n\r\n    if (!result.error) {\r\n      console.log(\r\n        \"Story was successful, showing success message and redirecting\"\r\n      );\r\n      form.innerHTML = `\r\n        <div class=\"alert alert-success\">\r\n          <p><i class=\"fas fa-check-circle\"></i> Story submitted successfully!</p>\r\n          <p>Redirecting to home page...</p>\r\n        </div>\r\n        <a href=\"#/\" class=\"btn btn-block\">Back to Home</a>\r\n      `;\r\n\r\n      // Stop the camera stream if it's still active\r\n      if (this.stream) {\r\n        this.stream.getTracks().forEach((track) => track.stop());\r\n        this.stream = null;\r\n      }\r\n\r\n      // Auto-redirect to home after 2 seconds\r\n      console.log(\"Setting up redirect timer for 2 seconds\");\r\n      setTimeout(() => {\r\n        console.log(\"Redirecting to home page now\");\r\n        window.location.hash = \"#/\";\r\n      }, 2000);\r\n    } else {\r\n      console.log(\"Story submission failed, showing error message\");\r\n      form.insertAdjacentHTML(\r\n        \"afterbegin\",\r\n        `\r\n        <div class=\"alert alert-danger\">\r\n          <p><i class=\"fas fa-exclamation-circle\"></i> Failed to submit story: ${result.message}</p>\r\n        </div>\r\n      `\r\n      );\r\n    }\r\n  }\r\n  _testNotification() {\r\n    console.log(\"Testing notification from view...\");\r\n    try {\r\n      // Test simple browser notification directly\r\n      if (Notification.permission === \"granted\") {\r\n        const notification = new Notification(\"Test Notification\", {\r\n          body: \"This is a test notification to check if notifications work\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        });\r\n\r\n        notification.onclick = function () {\r\n          console.log(\"Test notification clicked\");\r\n          notification.close();\r\n        };\r\n\r\n        console.log(\"Test notification sent successfully\");\r\n      } else if (Notification.permission === \"default\") {\r\n        // Request permission\r\n        Notification.requestPermission().then((permission) => {\r\n          if (permission === \"granted\") {\r\n            this._testNotification(); // Retry after permission granted\r\n          } else {\r\n            alert(\r\n              \"Notification permission denied. Please enable notifications in browser settings.\"\r\n            );\r\n          }\r\n        });\r\n      } else {\r\n        console.log(\"Notification permission denied\");\r\n        alert(\r\n          \"Notification permission denied. Please enable notifications in browser settings.\"\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error sending test notification:\", error);\r\n      alert(\"Error sending test notification: \" + error.message);\r\n    }\r\n  }\r\n\r\n  cleanup() {\r\n    // Stop the camera stream if it's still active\r\n    if (this.stream) {\r\n      this.stream.getTracks().forEach((track) => track.stop());\r\n      this.stream = null;\r\n    }\r\n  }\r\n}\r\n\r\nexport default AddStoryView;\r\n","class AuthView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n  }\r\n\r\n  renderLogin() {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"form-container\">\r\n          <h2><i class=\"fas fa-sign-in-alt\"></i> Login</h2>\r\n          <form id=\"login-form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"email\">Email</label>\r\n              <input type=\"email\" id=\"email\" class=\"form-control\" required>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"password\">Password</label>\r\n              <input type=\"password\" id=\"password\" class=\"form-control\" required>\r\n            </div>\r\n            <button type=\"submit\" class=\"btn btn-block\">Login</button>\r\n            <p class=\"text-center mt-3\">\r\n              Don't have an account? <a href=\"#/register\">Register</a>\r\n            </p>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    `;\r\n\r\n    this._attachLoginEventListeners();\r\n  }\r\n\r\n  renderRegister() {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"form-container\">\r\n          <h2><i class=\"fas fa-user-plus\"></i> Register</h2>\r\n          <form id=\"register-form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"name\">Name</label>\r\n              <input type=\"text\" id=\"name\" class=\"form-control\" required>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"email\">Email</label>\r\n              <input type=\"email\" id=\"email\" class=\"form-control\" required>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"password\">Password (min. 8 characters)</label>\r\n              <input type=\"password\" id=\"password\" class=\"form-control\" minlength=\"8\" required>\r\n            </div>\r\n            <button type=\"submit\" class=\"btn btn-block\">Register</button>\r\n            <p class=\"text-center mt-3\">\r\n              Already have an account? <a href=\"#/login\">Login</a>\r\n            </p>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    `;\r\n\r\n    this._attachRegisterEventListeners();\r\n  }\r\n  _attachLoginEventListeners() {\r\n    const form = document.getElementById(\"login-form\");\r\n    if (!form) {\r\n      console.error(\r\n        \"Login form not found when trying to attach event listeners\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    form.addEventListener(\"submit\", (e) => {\r\n      e.preventDefault();\r\n\r\n      const emailInput = document.getElementById(\"email\");\r\n      const passwordInput = document.getElementById(\"password\");\r\n\r\n      if (!emailInput || !passwordInput) {\r\n        console.error(\"Login form inputs not found\");\r\n        return;\r\n      }\r\n\r\n      const email = emailInput.value;\r\n      const password = passwordInput.value;\r\n\r\n      // Dispatch custom event for login\r\n      const event = new CustomEvent(\"auth:login\", {\r\n        detail: { email, password },\r\n      });\r\n      document.dispatchEvent(event);\r\n    });\r\n  }\r\n  _attachRegisterEventListeners() {\r\n    const form = document.getElementById(\"register-form\");\r\n    if (!form) {\r\n      console.error(\r\n        \"Register form not found when trying to attach event listeners\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    form.addEventListener(\"submit\", (e) => {\r\n      e.preventDefault();\r\n\r\n      const nameInput = document.getElementById(\"name\");\r\n      const emailInput = document.getElementById(\"email\");\r\n      const passwordInput = document.getElementById(\"password\");\r\n\r\n      if (!nameInput || !emailInput || !passwordInput) {\r\n        console.error(\"Register form inputs not found\");\r\n        return;\r\n      }\r\n\r\n      const name = nameInput.value;\r\n      const email = emailInput.value;\r\n      const password = passwordInput.value;\r\n\r\n      // Dispatch custom event for registration\r\n      const event = new CustomEvent(\"auth:register\", {\r\n        detail: { name, email, password },\r\n      });\r\n      document.dispatchEvent(event);\r\n    });\r\n  }\r\n  showAuthResult(result, type) {\r\n    const form = document.getElementById(`${type}-form`);\r\n\r\n    // Check if form exists\r\n    if (!form) {\r\n      console.error(`Form with id \"${type}-form\" not found.`);\r\n      return;\r\n    }\r\n\r\n    // Remove any existing alerts\r\n    const existingAlert = form.querySelector(\".alert\");\r\n    if (existingAlert) {\r\n      existingAlert.remove();\r\n    }\r\n\r\n    if (!result.error) {\r\n      form.insertAdjacentHTML(\r\n        \"afterbegin\",\r\n        `\r\n        <div class=\"alert alert-success\">\r\n          <p><i class=\"fas fa-check-circle\"></i> ${result.message}</p>\r\n        </div>\r\n      `\r\n      );\r\n      if (type === \"login\") {\r\n        // Trigger notification initialization event\r\n        setTimeout(() => {\r\n          document.dispatchEvent(new CustomEvent(\"user:loggedIn\"));\r\n        }, 500);\r\n\r\n        // Redirect to home after successful login\r\n        setTimeout(() => {\r\n          window.location.hash = \"#/\";\r\n        }, 1000);\r\n      } else if (type === \"register\") {\r\n        // Redirect to login after successful registration\r\n        setTimeout(() => {\r\n          window.location.hash = \"#/login\";\r\n        }, 1000);\r\n      }\r\n    } else {\r\n      form.insertAdjacentHTML(\r\n        \"afterbegin\",\r\n        `\r\n        <div class=\"alert alert-danger\">\r\n          <p><i class=\"fas fa-exclamation-circle\"></i> ${result.message}</p>\r\n        </div>\r\n      `\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default AuthView;\r\n","class MapView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n    this.map = null;\r\n    this.markers = [];\r\n  }\r\n  render(stories = []) {\r\n    console.log(\"MapView.render() called with\", stories.length, \"stories\");\r\n\r\n    // Add a loading indicator first\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <h2><i class=\"fas fa-map-marked-alt\"></i> Stories Map</h2>\r\n        <div id=\"map-loading\" class=\"alert\">Loading map...</div>\r\n        <div class=\"map-container\">\r\n          <div id=\"stories-map\" style=\"height: 600px; width: 100%;\"></div>\r\n        </div>\r\n        <div class=\"map-legend\">\r\n          <p><strong>Total Stories with Location:</strong> <span id=\"stories-count\">${\r\n            stories.filter((s) => s.lat && s.lon).length\r\n          }</span></p>\r\n          <p class=\"map-info\">Click on any marker to see the story details</p>\r\n        </div>\r\n      </section>\r\n    `;\r\n\r\n    // Make sure the map container is visible\r\n    const mapContainer = document.querySelector(\".map-container\");\r\n    if (mapContainer) {\r\n      mapContainer.style.display = \"block\";\r\n    }\r\n\r\n    // Longer timeout to ensure DOM is fully rendered\r\n    setTimeout(() => {\r\n      this._initializeMap(stories);\r\n      const loadingEl = document.getElementById(\"map-loading\");\r\n      if (loadingEl) loadingEl.style.display = \"none\";\r\n    }, 1000);\r\n  }\r\n  _initializeMap(stories) {\r\n    try {\r\n      console.log(\"Initializing map with\", stories.length, \"stories\");\r\n\r\n      // Check if the map container exists\r\n      const mapElement = document.getElementById(\"stories-map\");\r\n      if (!mapElement) {\r\n        console.error(\"Map container element #stories-map not found!\");\r\n        return;\r\n      }\r\n\r\n      // Make sure the map element is visible and has dimensions\r\n      mapElement.style.display = \"block\";\r\n      const rect = mapElement.getBoundingClientRect();\r\n      console.log(\"Map container dimensions:\", rect.width, \"x\", rect.height);\r\n\r\n      if (rect.width === 0 || rect.height === 0) {\r\n        console.warn(\r\n          \"Map container has zero dimensions, setting explicit size\"\r\n        );\r\n        mapElement.style.width = \"100%\";\r\n        mapElement.style.height = \"600px\";\r\n      }\r\n\r\n      // Check if Leaflet is loaded\r\n      if (typeof L === \"undefined\") {\r\n        console.error(\"Leaflet library not loaded\");\r\n        mapElement.innerHTML =\r\n          '<div class=\"alert alert-danger\">Map library failed to load. Please refresh the page.</div>';\r\n        return;\r\n      }\r\n\r\n      // Clear previous instance if any\r\n      if (this.map) {\r\n        console.log(\"Cleaning up previous map instance\");\r\n        this.map.remove();\r\n        this.map = null;\r\n      }\r\n\r\n      // Initialize map with options that ensure it displays even if container is initially hidden\r\n      console.log(\"Creating new map instance\");\r\n      this.map = L.map(\"stories-map\", {\r\n        center: [-2.5, 118], // Center on Indonesia\r\n        zoom: 5,\r\n        scrollWheelZoom: true,\r\n        zoomControl: true,\r\n        preferCanvas: true,\r\n      });\r\n\r\n      // Force a repaint of the container\r\n      mapElement.style.opacity = \"0.99\";\r\n      setTimeout(() => {\r\n        mapElement.style.opacity = \"1\";\r\n      }, 0);\r\n\r\n      console.log(\"Map object created successfully\");\r\n\r\n      // Base layers\r\n      const osmLayer = L.tileLayer(\r\n        \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n        {\r\n          attribution:\r\n            '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n          maxZoom: 19,\r\n        }\r\n      );\r\n\r\n      // Add more layer options\r\n      const satelliteLayer = L.tileLayer(\r\n        \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",\r\n        {\r\n          attribution:\r\n            \"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\",\r\n          maxZoom: 19,\r\n        }\r\n      );\r\n\r\n      const darkLayer = L.tileLayer(\r\n        \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\",\r\n        {\r\n          attribution:\r\n            '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\r\n          subdomains: \"abcd\",\r\n          maxZoom: 19,\r\n        }\r\n      );\r\n\r\n      const baseMaps = {\r\n        OpenStreetMap: osmLayer,\r\n        Satellite: satelliteLayer,\r\n        \"Dark Mode\": darkLayer,\r\n      };\r\n\r\n      // Set default layer\r\n      osmLayer.addTo(this.map);\r\n\r\n      // Add layer control\r\n      L.control.layers(baseMaps).addTo(this.map);\r\n\r\n      // Add markers for stories with location\r\n      this._addStoryMarkers(stories);\r\n      // Force a map refresh\r\n      setTimeout(() => {\r\n        console.log(\"Invalidating map size\");\r\n        this.map.invalidateSize(true);\r\n\r\n        // Add a retry mechanism to make sure the map renders correctly\r\n        this._ensureMapIsRendered();\r\n      }, 300);\r\n    } catch (error) {\r\n      console.error(\"Error in _initializeMap:\", error);\r\n      const mapElement = document.getElementById(\"stories-map\");\r\n      if (mapElement) {\r\n        mapElement.innerHTML =\r\n          '<div class=\"alert alert-danger\">An error occurred while initializing the map. Please refresh the page.</div>';\r\n      }\r\n    }\r\n  }\r\n\r\n  _addStoryMarkers(stories) {\r\n    try {\r\n      // Clear existing markers\r\n      if (this.markers && this.markers.length) {\r\n        this.markers.forEach((marker) => {\r\n          if (this.map) this.map.removeLayer(marker);\r\n        });\r\n      }\r\n      this.markers = [];\r\n\r\n      // Add markers for stories with location\r\n      stories.forEach((story) => {\r\n        if (story.lat && story.lon) {\r\n          try {\r\n            const marker = L.marker([story.lat, story.lon]).addTo(this.map)\r\n              .bindPopup(`\r\n                <div class=\"map-popup\">\r\n                  <h3>${story.name}</h3>\r\n                  <img src=\"${story.photoUrl}\" alt=\"Photo by ${\r\n              story.name\r\n            }\" style=\"width: 100%; max-height: 120px; object-fit: cover;\">\r\n                  <p>${this._truncateDescription(story.description)}</p>\r\n                  <a href=\"#/story/${\r\n                    story.id\r\n                  }\" class=\"btn btn-small\">View Details</a>\r\n                </div>\r\n              `);\r\n\r\n            this.markers.push(marker);\r\n          } catch (markerError) {\r\n            console.error(\r\n              \"Error creating marker for story:\",\r\n              story.id,\r\n              markerError\r\n            );\r\n          }\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${this.markers.length} markers to the map`);\r\n    } catch (error) {\r\n      console.error(\"Error in _addStoryMarkers:\", error);\r\n    }\r\n  }\r\n\r\n  _truncateDescription(description, maxLength = 50) {\r\n    if (description.length <= maxLength) return description;\r\n    return description.substring(0, maxLength) + \"...\";\r\n\r\n    // Base layers\r\n    const osmLayer = L.tileLayer(\r\n      \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n      {\r\n        attribution:\r\n          '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n        maxZoom: 19,\r\n      }\r\n    );\r\n\r\n    // Add more layer options\r\n    const satelliteLayer = L.tileLayer(\r\n      \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",\r\n      {\r\n        attribution:\r\n          \"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\",\r\n        maxZoom: 19,\r\n      }\r\n    );\r\n\r\n    const darkLayer = L.tileLayer(\r\n      \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\",\r\n      {\r\n        attribution:\r\n          '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\r\n        subdomains: \"abcd\",\r\n        maxZoom: 19,\r\n      }\r\n    );\r\n\r\n    const baseMaps = {\r\n      OpenStreetMap: osmLayer,\r\n      Satellite: satelliteLayer,\r\n      \"Dark Mode\": darkLayer,\r\n    };\r\n\r\n    // Set default layer\r\n    osmLayer.addTo(this.map);\r\n\r\n    // Add layer control\r\n    L.control.layers(baseMaps).addTo(this.map);\r\n\r\n    // Add markers for stories with location\r\n    this._addStoryMarkers(stories);\r\n  }\r\n\r\n  _addStoryMarkers(stories) {\r\n    // Clear existing markers\r\n    this.markers.forEach((marker) => this.map.removeLayer(marker));\r\n    this.markers = [];\r\n\r\n    // Add markers for stories with location\r\n    stories.forEach((story) => {\r\n      if (story.lat && story.lon) {\r\n        const marker = L.marker([story.lat, story.lon]).addTo(this.map)\r\n          .bindPopup(`\r\n            <div class=\"map-popup\">\r\n              <h3>${story.name}</h3>\r\n              <img src=\"${story.photoUrl}\" alt=\"Photo by ${\r\n          story.name\r\n        }\" style=\"width: 100%; max-height: 120px; object-fit: cover;\">\r\n              <p>${this._truncateDescription(story.description)}</p>\r\n              <a href=\"#/story/${\r\n                story.id\r\n              }\" class=\"btn btn-small\">View Details</a>\r\n            </div>\r\n          `);\r\n\r\n        this.markers.push(marker);\r\n      }\r\n    });\r\n  }\r\n  _truncateDescription(description, maxLength = 50) {\r\n    if (description.length <= maxLength) return description;\r\n    return description.substring(0, maxLength) + \"...\";\r\n  }\r\n\r\n  _ensureMapIsRendered() {\r\n    // This is a safety mechanism to make sure the map renders correctly\r\n    // It will check if the map tiles are visible, and if not, try to redraw the map\r\n    if (!this.map) return;\r\n\r\n    const mapContainer = document.getElementById(\"stories-map\");\r\n    if (!mapContainer) return;\r\n\r\n    const tilesLoaded = document.querySelector(\".leaflet-tile\");\r\n    if (\r\n      !tilesLoaded ||\r\n      window.getComputedStyle(tilesLoaded).display === \"none\"\r\n    ) {\r\n      console.log(\"Map tiles not properly rendered, trying to redraw\");\r\n\r\n      // Force map redraw\r\n      this.map.invalidateSize(true);\r\n\r\n      // Check again after a short delay\r\n      setTimeout(() => {\r\n        const tilesLoaded = document.querySelector(\".leaflet-tile\");\r\n        if (\r\n          !tilesLoaded ||\r\n          window.getComputedStyle(tilesLoaded).display === \"none\"\r\n        ) {\r\n          console.log(\r\n            \"Map still not rendering properly, trying one more time with different approach\"\r\n          );\r\n\r\n          // Final attempt - toggle display and redraw\r\n          mapContainer.style.display = \"none\";\r\n          setTimeout(() => {\r\n            mapContainer.style.display = \"block\";\r\n            this.map.invalidateSize(true);\r\n          }, 200);\r\n        }\r\n      }, 500);\r\n    }\r\n  }\r\n}\r\n\r\nexport default MapView;\r\n","class FavoritesView {\r\n  constructor() {\r\n    this.app = document.getElementById(\"app-container\");\r\n  }\r\n\r\n  render(favorites = []) {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"favorites-header\">\r\n          <h2><i class=\"fas fa-heart\"></i> My Favorites</h2>\r\n          <p class=\"favorites-subtitle\">\r\n            ${\r\n              favorites.length > 0\r\n                ? `You have ${favorites.length} favorite ${\r\n                    favorites.length === 1 ? \"story\" : \"stories\"\r\n                  }`\r\n                : \"No favorite stories yet. Start adding some!\"\r\n            }\r\n          </p>\r\n        </div>\r\n        \r\n        <div id=\"favorites-container\" class=\"favorites-container\">\r\n          ${this._renderFavorites(favorites)}\r\n        </div>\r\n        \r\n        ${favorites.length === 0 ? this._renderEmptyState() : \"\"}\r\n      </section>\r\n    `;\r\n\r\n    this._attachEventListeners();\r\n  }\r\n  _renderFavorites(favorites) {\r\n    if (favorites.length === 0) {\r\n      return \"\";\r\n    }\r\n\r\n    return `\r\n      <div class=\"story-list\">\r\n        ${favorites\r\n          .map(\r\n            (story) => `\r\n          <article class=\"story-card\" data-story-id=\"${story.id}\">\r\n            <div class=\"story-thumbnail\">\r\n              <img src=\"${story.photoUrl}\" alt=\"Story by ${\r\n              story.name\r\n            }\" loading=\"lazy\">\r\n              <button class=\"favorite-btn active\" data-story-id=\"${\r\n                story.id\r\n              }\" title=\"Remove from favorites\">\r\n                <i class=\"fas fa-heart\" id=\"heart-${story.id}\"></i>\r\n              </button>\r\n            </div>\r\n            <div class=\"story-info\">\r\n              <div class=\"story-header\">\r\n                <div class=\"author-info\">\r\n                  <div class=\"author-avatar\">\r\n                    <i class=\"fas fa-user-circle\"></i>\r\n                  </div>\r\n                  <div class=\"author-details\">\r\n                    <span class=\"author-name\">${\r\n                      story.name || \"Anonymous\"\r\n                    }</span>\r\n                    <span class=\"upload-date\">${this._formatDate(\r\n                      story.addedAt || story.createdAt\r\n                    )}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"story-content\">\r\n                <h3 class=\"story-title\">${this._truncateText(\r\n                  story.description,\r\n                  60\r\n                )}</h3>\r\n                <p class=\"story-description\">${this._truncateText(\r\n                  story.description,\r\n                  120\r\n                )}</p>\r\n              </div>\r\n              <div class=\"story-actions\">\r\n                <button class=\"btn-detail view-btn\" data-story-id=\"${story.id}\">\r\n                  <i class=\"fas fa-eye\"></i> View Details\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </article>\r\n        `\r\n          )\r\n          .join(\"\")}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  _renderEmptyState() {\r\n    return `\r\n      <div class=\"empty-state\">\r\n        <div class=\"empty-state-icon\">\r\n          <i class=\"far fa-heart\"></i>\r\n        </div>\r\n        <h3>No Favorites Yet</h3>\r\n        <p>Start exploring stories and add them to your favorites by clicking the heart icon!</p>\r\n        <div class=\"empty-state-actions\">\r\n          <a href=\"#/\" class=\"btn btn-primary\">\r\n            <i class=\"fas fa-home\"></i> Browse Stories\r\n          </a>\r\n          <a href=\"#/map\" class=\"btn btn-secondary\">\r\n            <i class=\"fas fa-map\"></i> Explore Map\r\n          </a>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    const favoritesContainer = document.getElementById(\"favorites-container\");\r\n\r\n    // Delegate events to the container\r\n    favoritesContainer.addEventListener(\"click\", (e) => {\r\n      if (e.target.closest(\".favorite-btn\")) {\r\n        const btn = e.target.closest(\".favorite-btn\");\r\n        const storyId = btn.dataset.storyId;\r\n        this._handleFavoriteToggle(storyId, btn);\r\n      } else if (e.target.closest(\".btn-detail, .view-btn\")) {\r\n        const btn = e.target.closest(\".btn-detail, .view-btn\");\r\n        const storyId = btn.dataset.storyId;\r\n        this._handleViewStory(storyId);\r\n      } else if (e.target.closest(\".share-btn\")) {\r\n        const btn = e.target.closest(\".share-btn\");\r\n        const storyId = btn.dataset.storyId;\r\n        this._handleShareStory(storyId);\r\n      }\r\n    });\r\n  }\r\n\r\n  _handleFavoriteToggle(storyId, btn) {\r\n    // Dispatch custom event to presenter\r\n    const event = new CustomEvent(\"favorite:toggle\", {\r\n      detail: { storyId },\r\n    });\r\n    document.dispatchEvent(event);\r\n\r\n    // Provide immediate visual feedback\r\n    btn.classList.add(\"removing\");\r\n    btn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i>';\r\n  }\r\n\r\n  _handleViewStory(storyId) {\r\n    window.location.hash = `#/story/${storyId}`;\r\n  }\r\n\r\n  _handleShareStory(storyId) {\r\n    if (navigator.share) {\r\n      navigator\r\n        .share({\r\n          title: \"Check out this story!\",\r\n          text: \"I found this interesting story on Dicoding Story App\",\r\n          url: `${window.location.origin}${window.location.pathname}#/story/${storyId}`,\r\n        })\r\n        .catch(console.error);\r\n    } else {\r\n      // Fallback: copy to clipboard\r\n      const url = `${window.location.origin}${window.location.pathname}#/story/${storyId}`;\r\n      navigator.clipboard\r\n        .writeText(url)\r\n        .then(() => {\r\n          this.showToast(\"Story link copied to clipboard!\");\r\n        })\r\n        .catch(() => {\r\n          this.showToast(\"Unable to share story\", \"error\");\r\n        });\r\n    }\r\n  }\r\n\r\n  showLoadingState() {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"favorites-header\">\r\n          <h2><i class=\"fas fa-heart\"></i> My Favorites</h2>\r\n        </div>\r\n        <div class=\"loading-container\">\r\n          <div class=\"loading-spinner\">\r\n            <i class=\"fas fa-spinner fa-spin\"></i>\r\n          </div>\r\n          <p>Loading your favorite stories...</p>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  showError(message) {\r\n    this.app.innerHTML = `\r\n      <section class=\"container\">\r\n        <div class=\"favorites-header\">\r\n          <h2><i class=\"fas fa-heart\"></i> My Favorites</h2>\r\n        </div>\r\n        <div class=\"alert alert-danger\">\r\n          <i class=\"fas fa-exclamation-circle\"></i>\r\n          <p>${message}</p>\r\n          <button class=\"btn btn-secondary\" onclick=\"window.location.reload()\">\r\n            <i class=\"fas fa-redo\"></i> Try Again\r\n          </button>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  showToast(message, type = \"success\") {\r\n    // Create toast notification\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast-${type}`;\r\n    toast.innerHTML = `\r\n      <div class=\"toast-content\">\r\n        <i class=\"fas ${\r\n          type === \"success\" ? \"fa-check-circle\" : \"fa-exclamation-circle\"\r\n        }\"></i>\r\n        <span>${message}</span>\r\n      </div>\r\n    `;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Show toast\r\n    setTimeout(() => toast.classList.add(\"show\"), 100);\r\n\r\n    // Hide and remove toast\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      setTimeout(() => document.body.removeChild(toast), 300);\r\n    }, 3000);\r\n  }\r\n  removeFavoriteFromView(storyId) {\r\n    const storyCard = document.querySelector(`[data-story-id=\"${storyId}\"]`);\r\n    if (storyCard) {\r\n      storyCard.style.transition = \"opacity 0.3s ease, transform 0.3s ease\";\r\n      storyCard.style.opacity = \"0\";\r\n      storyCard.style.transform = \"scale(0.95)\";\r\n\r\n      setTimeout(() => {\r\n        storyCard.remove();\r\n\r\n        // Check if no favorites left - use correct selector\r\n        const remainingCards = document.querySelectorAll(\r\n          \".story-card[data-story-id]\"\r\n        );\r\n        if (remainingCards.length === 0) {\r\n          document.getElementById(\"favorites-container\").innerHTML =\r\n            this._renderEmptyState();\r\n\r\n          // Update header\r\n          const subtitle = document.querySelector(\".favorites-subtitle\");\r\n          if (subtitle) {\r\n            subtitle.textContent =\r\n              \"No favorite stories yet. Start adding some!\";\r\n          }\r\n        } else {\r\n          // Update count in header\r\n          const subtitle = document.querySelector(\".favorites-subtitle\");\r\n          if (subtitle) {\r\n            const count = remainingCards.length;\r\n            subtitle.textContent = `You have ${count} favorite ${\r\n              count === 1 ? \"story\" : \"stories\"\r\n            }`;\r\n          }\r\n        }\r\n      }, 300);\r\n    }\r\n  }\r\n\r\n  _truncateText(text, maxLength) {\r\n    if (text.length <= maxLength) return text;\r\n    return text.substring(0, maxLength) + \"...\";\r\n  }\r\n\r\n  _formatDate(dateString) {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString(\"en-US\", {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n    });\r\n  }\r\n\r\n  _formatRelativeDate(dateString) {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffTime = Math.abs(now - date);\r\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffDays === 0) return \"today\";\r\n    if (diffDays === 1) return \"yesterday\";\r\n    if (diffDays < 7) return `${diffDays} days ago`;\r\n    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\r\n    return `${Math.floor(diffDays / 30)} months ago`;\r\n  }\r\n}\r\n\r\nexport default FavoritesView;\r\n","class NotFoundView {\r\n  constructor() {\r\n    this.element = null;\r\n  }\r\n\r\n  render() {\r\n    const notFoundContainer = document.createElement(\"div\");\r\n    notFoundContainer.className = \"not-found-container\";\r\n    notFoundContainer.innerHTML = `\r\n      <div class=\"not-found-content\">\r\n        <div class=\"not-found-icon\">\r\n          <i class=\"fas fa-search\"></i>\r\n          <span class=\"icon-404\">404</span>\r\n        </div>\r\n        <h1>Page Not Found</h1>\r\n        <p>Oops! The page you're looking for doesn't exist.</p>\r\n        <p>It might have been moved, deleted, or you entered the wrong URL.</p>\r\n        <div class=\"not-found-actions\">\r\n          <button id=\"go-home-btn\" class=\"btn btn-primary\">\r\n            <i class=\"fas fa-home\"></i> Go to Home\r\n          </button>\r\n          <button id=\"go-back-btn\" class=\"btn btn-secondary\">\r\n            <i class=\"fas fa-arrow-left\"></i> Go Back\r\n          </button>\r\n        </div>        <div class=\"not-found-suggestions\">\r\n          <h3>You might want to:</h3>\r\n          <ul>\r\n            <li><a href=\"#/\">Browse all stories</a></li>\r\n            <li><a href=\"#/add\">Share your story</a></li>\r\n            <li><a href=\"#/map\">Explore story locations</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    this.element = notFoundContainer;\r\n    this.bindEvents();\r\n    return notFoundContainer;\r\n  }\r\n  bindEvents() {\r\n    const goHomeBtn = this.element.querySelector(\"#go-home-btn\");\r\n    const goBackBtn = this.element.querySelector(\"#go-back-btn\");\r\n\r\n    goHomeBtn.addEventListener(\"click\", () => {\r\n      window.location.hash = \"#/\";\r\n    });\r\n\r\n    goBackBtn.addEventListener(\"click\", () => {\r\n      if (window.history.length > 1) {\r\n        window.history.back();\r\n      } else {\r\n        window.location.hash = \"#/\";\r\n      }\r\n    });\r\n  }\r\n\r\n  show() {\r\n    const appContainer = document.getElementById(\"app-container\");\r\n    appContainer.innerHTML = \"\";\r\n    appContainer.appendChild(this.render());\r\n\r\n    // Update page title\r\n    document.title = \"Page Not Found - Dicoding Story App\";\r\n\r\n    // Add animation\r\n    this.element.style.opacity = \"0\";\r\n    this.element.style.transform = \"translateY(20px)\";\r\n\r\n    requestAnimationFrame(() => {\r\n      this.element.style.transition = \"opacity 0.3s ease, transform 0.3s ease\";\r\n      this.element.style.opacity = \"1\";\r\n      this.element.style.transform = \"translateY(0)\";\r\n    });\r\n  }\r\n}\r\n\r\nexport default NotFoundView;\r\n","class NotificationHelper {\r\n  constructor() {\r\n    // VAPID public key dari Dicoding Story API - Updated\r\n    this.vapidPublicKey =\r\n      \"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk\";\r\n    this.apiUrl = \"https://story-api.dicoding.dev/v1\";\r\n  }\r\n\r\n  async init() {\r\n    if (!(\"serviceWorker\" in navigator)) {\r\n      console.warn(\"Service Worker not supported\");\r\n      return false;\r\n    }\r\n\r\n    if (!(\"PushManager\" in window)) {\r\n      console.warn(\"Push messaging not supported\");\r\n      return false;\r\n    }\r\n\r\n    if (!(\"Notification\" in window)) {\r\n      console.warn(\"Notifications not supported\");\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      // Request notification permission\r\n      const permission = await this.requestPermission();\r\n      if (permission !== \"granted\") {\r\n        console.warn(\"Notification permission not granted\");\r\n        return false;\r\n      }\r\n\r\n      // Get service worker registration from VitePWA\r\n      const registration = await navigator.serviceWorker.ready;\r\n      console.log(\"Using VitePWA Service Worker:\", registration);\r\n\r\n      // Subscribe to push notifications\r\n      await this.subscribeUser(registration);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error initializing notifications:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  isPushNotificationSupported() {\r\n    return (\r\n      \"serviceWorker\" in navigator &&\r\n      \"PushManager\" in window &&\r\n      \"Notification\" in window\r\n    );\r\n  }\r\n\r\n  async requestPermission() {\r\n    if (Notification.permission === \"default\") {\r\n      const permission = await Notification.requestPermission();\r\n      return permission;\r\n    }\r\n    return Notification.permission;\r\n  }\r\n\r\n  async subscribeUser(registration) {\r\n    try {\r\n      const subscription = await registration.pushManager.subscribe({\r\n        userVisibleOnly: true,\r\n        applicationServerKey: this.urlBase64ToUint8Array(this.vapidPublicKey),\r\n      });\r\n\r\n      console.log(\"User subscribed to push notifications:\", subscription);\r\n\r\n      // Send subscription to server (optional - for server-side push)\r\n      await this.sendSubscriptionToServer(subscription);\r\n\r\n      return subscription;\r\n    } catch (error) {\r\n      console.error(\"Failed to subscribe user:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n  async sendSubscriptionToServer(subscription) {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) {\r\n        console.warn(\"No auth token available for subscription\");\r\n        return false;\r\n      }\r\n\r\n      // Prepare subscription data according to API docs\r\n      const subscriptionData = {\r\n        endpoint: subscription.endpoint,\r\n        keys: {\r\n          p256dh: subscription.keys.p256dh,\r\n          auth: subscription.keys.auth,\r\n        },\r\n      };\r\n\r\n      const response = await fetch(`${this.apiUrl}/notifications/subscribe`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(subscriptionData),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.error === false) {\r\n        console.log(\"Successfully subscribed to push notifications:\", data);\r\n        return true;\r\n      } else {\r\n        console.error(\"Failed to subscribe:\", data.message);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error sending subscription to server:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async showNotification(title, options = {}) {\r\n    if (Notification.permission !== \"granted\") {\r\n      console.warn(\"Notification permission not granted\");\r\n      return;\r\n    }\r\n\r\n    const defaultOptions = {\r\n      icon: \"/icons/app-icon.svg\",\r\n      badge: \"/icons/app-icon.svg\",\r\n      vibrate: [200, 100, 200],\r\n      tag: \"story-notification\",\r\n      renotify: true,\r\n      requireInteraction: false,\r\n      ...options,\r\n    };\r\n\r\n    try {\r\n      // Try to use service worker notification first\r\n      const registration = await navigator.serviceWorker.ready;\r\n      if (registration) {\r\n        await registration.showNotification(title, defaultOptions);\r\n      } else {\r\n        // Fallback to regular notification\r\n        new Notification(title, defaultOptions);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error showing notification:\", error);\r\n      // Fallback to regular notification\r\n      try {\r\n        new Notification(title, defaultOptions);\r\n      } catch (fallbackError) {\r\n        console.error(\"Fallback notification also failed:\", fallbackError);\r\n      }\r\n    }\r\n  }\r\n  async showStoryNotification(story) {\r\n    console.log(\"Showing story notification for:\", story);\r\n\r\n    // Check notification permission first\r\n    console.log(\"Notification permission:\", Notification.permission);\r\n\r\n    if (Notification.permission !== \"granted\") {\r\n      console.warn(\r\n        \"Notification permission not granted, requesting permission...\"\r\n      );\r\n      const permission = await this.requestPermission();\r\n      if (permission !== \"granted\") {\r\n        console.error(\"User denied notification permission\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    const title = \"Story berhasil dibuat\";\r\n    const options = {\r\n      body: `Anda telah membuat story baru dengan deskripsi: ${story.description}`,\r\n      icon: \"/icons/app-icon.svg\",\r\n      image:\r\n        story.photoUrl && story.photoUrl !== \"default-image\"\r\n          ? story.photoUrl\r\n          : undefined,\r\n      data: {\r\n        url: `/#/story/${story.id}`,\r\n        storyId: story.id,\r\n      },\r\n      tag: \"story-created\",\r\n      requireInteraction: true,\r\n      actions: [\r\n        {\r\n          action: \"view\",\r\n          title: \"View Story\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        },\r\n        {\r\n          action: \"close\",\r\n          title: \"Close\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        },\r\n      ],\r\n    };\r\n    try {\r\n      console.log(\"Attempting to show notification with options:\", options);\r\n\r\n      // Simplified notification approach - try browser notification first\r\n      console.log(\"Using simple browser notification\");\r\n      const notification = new Notification(title, {\r\n        body: options.body,\r\n        icon: options.icon,\r\n        tag: options.tag,\r\n        requireInteraction: false, // Simplified - don't require interaction\r\n        data: options.data,\r\n      });\r\n\r\n      console.log(\"Browser notification created successfully\");\r\n\r\n      // Add click handler\r\n      notification.onclick = function (event) {\r\n        console.log(\"Notification clicked\");\r\n        event.preventDefault();\r\n        window.focus();\r\n        if (options.data && options.data.url) {\r\n          window.location.hash = options.data.url;\r\n        }\r\n        notification.close();\r\n      };\r\n\r\n      console.log(\"Story notification displayed successfully\");\r\n    } catch (error) {\r\n      console.error(\"Error displaying story notification:\", error);\r\n      // Final fallback to very simple notification\r\n      try {\r\n        console.log(\"Using minimal fallback notification\");\r\n        new Notification(\"Story berhasil dibuat\", {\r\n          body: \"Story Anda telah berhasil dibuat!\",\r\n        });\r\n        console.log(\"Minimal notification sent successfully\");\r\n      } catch (fallbackError) {\r\n        console.error(\"All notification methods failed:\", fallbackError);\r\n      }\r\n    }\r\n  }\r\n\r\n  async showWelcomeNotification() {\r\n    const options = {\r\n      body: \"Welcome to Dicoding Story App! Start sharing your stories.\",\r\n      icon: \"/icons/app-icon.svg\",\r\n      data: {\r\n        url: \"/#/add\",\r\n      },\r\n      actions: [\r\n        {\r\n          action: \"add-story\",\r\n          title: \"Add Story\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        },\r\n      ],\r\n    };\r\n\r\n    await this.showNotification(\"Welcome to Story App!\", options);\r\n  }\r\n\r\n  async showOfflineNotification() {\r\n    const options = {\r\n      body: \"You are currently offline. Some features may be limited.\",\r\n      icon: \"/icons/app-icon.svg\",\r\n      tag: \"offline-notification\",\r\n    };\r\n\r\n    await this.showNotification(\"You are offline\", options);\r\n  }\r\n\r\n  async showOnlineNotification() {\r\n    const options = {\r\n      body: \"You are back online! All features are now available.\",\r\n      icon: \"/icons/app-icon.svg\",\r\n      tag: \"online-notification\",\r\n    };\r\n\r\n    await this.showNotification(\"You are online\", options);\r\n  }\r\n\r\n  urlBase64ToUint8Array(base64String) {\r\n    const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\r\n    const base64 = (base64String + padding)\r\n      .replace(/-/g, \"+\")\r\n      .replace(/_/g, \"/\");\r\n\r\n    const rawData = window.atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n      outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n  }\r\n  // Check if notifications are supported and enabled\r\n  isSupported() {\r\n    return (\r\n      \"Notification\" in window &&\r\n      \"serviceWorker\" in navigator &&\r\n      \"PushManager\" in window\r\n    );\r\n  }\r\n\r\n  isEnabled() {\r\n    return Notification.permission === \"granted\";\r\n  }\r\n\r\n  // Test notification method for debugging\r\n  async testNotification() {\r\n    console.log(\"Testing notification...\");\r\n    console.log(\"Notification permission:\", Notification.permission);\r\n    console.log(\"Push supported:\", this.isPushNotificationSupported());\r\n\r\n    if (Notification.permission === \"granted\") {\r\n      try {\r\n        // Try simple notification first\r\n        new Notification(\"Test Notification\", {\r\n          body: \"This is a test notification to verify functionality\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        });\r\n        console.log(\"Simple notification sent\");\r\n\r\n        // Try service worker notification\r\n        await this.showNotification(\"Service Worker Test\", {\r\n          body: \"This is a service worker notification test\",\r\n        });\r\n        console.log(\"Service worker notification sent\");\r\n      } catch (error) {\r\n        console.error(\"Test notification failed:\", error);\r\n      }\r\n    } else {\r\n      console.warn(\"Notification permission not granted\");\r\n    }\r\n  }\r\n\r\n  // Simple test notification for debugging\r\n  async testSimpleNotification() {\r\n    console.log(\"Testing simple notification...\");\r\n    try {\r\n      if (Notification.permission === \"granted\") {\r\n        const notification = new Notification(\"Test Notification\", {\r\n          body: \"This is a test notification\",\r\n          icon: \"/icons/app-icon.svg\",\r\n        });\r\n        console.log(\"Simple test notification sent successfully\");\r\n\r\n        notification.onclick = function () {\r\n          console.log(\"Test notification clicked\");\r\n          notification.close();\r\n        };\r\n\r\n        return true;\r\n      } else {\r\n        console.log(\"Permission not granted for notifications\");\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Test notification failed:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Get notification permission status\r\n  getPermissionStatus() {\r\n    if (!(\"Notification\" in window)) {\r\n      return \"not-supported\";\r\n    }\r\n    return Notification.permission;\r\n  }\r\n\r\n  // Get current push subscription\r\n  async getSubscription() {\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      return await registration.pushManager.getSubscription();\r\n    } catch (error) {\r\n      console.error(\"Error getting subscription:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Subscribe to notifications\r\n  async subscribeNotification() {\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      const subscription = await this.subscribeUser(registration);\r\n      return subscription;\r\n    } catch (error) {\r\n      console.error(\"Error subscribing to notifications:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Unsubscribe from notifications\r\n  async unsubscribeNotification() {\r\n    try {\r\n      const registration = await navigator.serviceWorker.ready;\r\n      const subscription = await registration.pushManager.getSubscription();\r\n\r\n      if (!subscription) {\r\n        console.log(\"No subscription to unsubscribe from\");\r\n        return true;\r\n      }\r\n\r\n      // Unsubscribe from browser\r\n      const successful = await subscription.unsubscribe();\r\n\r\n      if (successful) {\r\n        // Notify server about unsubscription\r\n        await this.sendUnsubscriptionToServer(subscription);\r\n        console.log(\"Successfully unsubscribed from push notifications\");\r\n        return true;\r\n      } else {\r\n        console.error(\"Failed to unsubscribe\");\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error unsubscribing from notifications:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Send unsubscription to server\r\n  async sendUnsubscriptionToServer(subscription) {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) {\r\n        console.warn(\"No auth token available for unsubscription\");\r\n        return false;\r\n      }\r\n\r\n      const response = await fetch(`${this.apiUrl}/notifications/subscribe`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          endpoint: subscription.endpoint,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.error === false) {\r\n        console.log(\"Successfully unsubscribed from server:\", data);\r\n        return true;\r\n      } else {\r\n        console.error(\"Failed to unsubscribe from server:\", data.message);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error sending unsubscription to server:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Register service worker (for compatibility with existing code)\r\n  async registerServiceWorker() {\r\n    // VitePWA handles service worker registration automatically\r\n    // This method is kept for compatibility\r\n    try {\r\n      return await navigator.serviceWorker.ready;\r\n    } catch (error) {\r\n      console.error(\"Error getting service worker:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport default NotificationHelper;\r\n","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/dicoding-story-app/sw.js\", { scope: \"/dicoding-story-app/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/dicoding-story-app/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","class HomePresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n    this.stories = [];\r\n\r\n    this._attachEventListeners();\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    // Listen for favorite toggle events from view\r\n    document.addEventListener(\"favorite:toggle\", async (e) => {\r\n      await this._handleFavoriteToggle(e.detail.storyId, e.detail.storyData);\r\n    });\r\n  }\r\n\r\n  async init() {\r\n    // Show loading state\r\n    this.view.render();\r\n\r\n    try {\r\n      // Check if user is logged in\r\n      if (this.model.isLoggedIn()) {\r\n        // Fetch stories with location\r\n        const result = await this.model.getStories(1, 10, 1);\r\n\r\n        if (!result.error) {\r\n          this.stories = result.listStory;\r\n          this.view.render(this.stories);\r\n\r\n          // Update favorite buttons based on current favorites\r\n          await this._updateFavoriteButtons();\r\n        } else {\r\n          console.error(\"Failed to fetch stories:\", result.message);\r\n          this.view.render([]);\r\n        }\r\n      } else {\r\n        // Redirect to login if not logged in\r\n        window.location.hash = \"#/login\";\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error initializing home page:\", error);\r\n      this.view.render([]);\r\n    }\r\n  }\r\n\r\n  async _updateFavoriteButtons() {\r\n    try {\r\n      for (const story of this.stories) {\r\n        const isFavorite = await this.model.isFavorite(story.id);\r\n        this.view.updateFavoriteButton(story.id, isFavorite);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating favorite buttons:\", error);\r\n    }\r\n  }\r\n\r\n  async _handleFavoriteToggle(storyId, storyData) {\r\n    try {\r\n      console.log(\"Toggling favorite for story:\", storyId);\r\n\r\n      // Check if story is currently favorite\r\n      const isFavorite = await this.model.isFavorite(storyId);\r\n\r\n      let result;\r\n      if (isFavorite) {\r\n        // Remove from favorites\r\n        result = await this._removeFavorite(storyId);\r\n        if (result.success) {\r\n          this.view.updateFavoriteButton(storyId, false);\r\n          const message = result.offline\r\n            ? \"Removed from favorites (will sync when online)\"\r\n            : \"Removed from favorites\";\r\n          this.view.showToast(message, \"success\");\r\n        }\r\n      } else {\r\n        // Add to favorites - need full story data\r\n        const fullStoryData = await this._getFullStoryData(storyId, storyData);\r\n        result = await this._addFavorite(fullStoryData);\r\n        if (result.success) {\r\n          this.view.updateFavoriteButton(storyId, true);\r\n          const message = result.offline\r\n            ? \"Added to favorites (will sync when online)\"\r\n            : \"Added to favorites\";\r\n          this.view.showToast(message, \"success\");\r\n        }\r\n      }\r\n\r\n      if (!result.success) {\r\n        this.view.showToast(\"Failed to update favorite\", \"error\");\r\n        // Reset button state\r\n        this.view.updateFavoriteButton(storyId, isFavorite);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error toggling favorite:\", error);\r\n      this.view.showToast(\"Failed to update favorite\", \"error\");\r\n    }\r\n  }\r\n\r\n  async _getFullStoryData(storyId, basicData) {\r\n    try {\r\n      // Try to get full story details\r\n      const result = await this.model.getStoryDetail(storyId);\r\n      if (!result.error && result.story) {\r\n        return result.story;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error getting full story data:\", error);\r\n    }\r\n\r\n    // Fallback to basic data from card\r\n    return {\r\n      id: storyId,\r\n      ...basicData,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  async _addFavorite(storyData) {\r\n    try {\r\n      // If offline, queue the action\r\n      if (!navigator.onLine) {\r\n        return await this._queueOfflineAction(\"add\", storyData.id, storyData);\r\n      } else {\r\n        // Add to IndexedDB\r\n        await this.model.addToFavorites(storyData);\r\n        return { success: true, offline: false };\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding favorite:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  async _removeFavorite(storyId) {\r\n    try {\r\n      // If offline, queue the action\r\n      if (!navigator.onLine) {\r\n        return await this._queueOfflineAction(\"remove\", storyId);\r\n      } else {\r\n        // Remove from IndexedDB\r\n        await this.model.removeFromFavorites(storyId);\r\n        return { success: true, offline: false };\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error removing favorite:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  async _queueOfflineAction(action, storyId, storyData = null) {\r\n    try {\r\n      // Get existing pending actions\r\n      const pendingActions = JSON.parse(\r\n        localStorage.getItem(\"pending_favorite_actions\") || \"[]\"\r\n      );\r\n\r\n      const offlineAction = {\r\n        id: Date.now(),\r\n        action,\r\n        storyId,\r\n        storyData,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n\r\n      pendingActions.push(offlineAction);\r\n\r\n      // Save to localStorage\r\n      localStorage.setItem(\r\n        \"pending_favorite_actions\",\r\n        JSON.stringify(pendingActions)\r\n      );\r\n\r\n      console.log(\"Queued offline favorite action:\", offlineAction);\r\n      return { success: true, offline: true };\r\n    } catch (error) {\r\n      console.error(\"Error queuing offline action:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  // Cleanup method\r\n  cleanup() {\r\n    // Remove event listeners if needed\r\n    // Currently using document listeners which persist\r\n  }\r\n}\r\n\r\nexport default HomePresenter;\r\n","class StoryDetailPresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n    this.currentStoryId = null;\r\n\r\n    // Bind event listeners\r\n    this._bindEvents();\r\n  }\r\n\r\n  _bindEvents() {\r\n    // Listen for favorite toggle events\r\n    document.addEventListener(\r\n      \"favorite:toggle\",\r\n      this._handleFavoriteToggle.bind(this)\r\n    );\r\n\r\n    // Listen for online status changes\r\n    window.addEventListener(\"online\", this._syncPendingActions.bind(this));\r\n  }\r\n\r\n  async init(id) {\r\n    // Show loading state\r\n    this.view.render(null, true);\r\n    this.currentStoryId = id;\r\n\r\n    try {\r\n      // Check if user is logged in\r\n      if (this.model.isLoggedIn()) {\r\n        // Fetch story details\r\n        const result = await this.model.getStoryDetail(id);\r\n        this.view.render(result, false);\r\n\r\n        // Update favorite button state\r\n        if (result && result.story) {\r\n          await this._updateFavoriteButtonState(result.story.id);\r\n        }\r\n      } else {\r\n        // Redirect to login if not logged in\r\n        window.location.hash = \"#/login\";\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching story details:\", error);\r\n      this.view.render({ error: true, message: error.message }, false);\r\n    }\r\n  }\r\n\r\n  async _updateFavoriteButtonState(storyId) {\r\n    try {\r\n      const isFavorite = await this.model.isFavorite(storyId);\r\n      this.view.updateFavoriteButton(storyId, isFavorite);\r\n    } catch (error) {\r\n      console.error(\"Error checking favorite status:\", error);\r\n    }\r\n  }\r\n\r\n  async _handleFavoriteToggle(event) {\r\n    const { storyId, storyData } = event.detail;\r\n\r\n    if (storyId !== this.currentStoryId) return;\r\n\r\n    try {\r\n      const isFavorite = await this.model.isFavorite(storyId);\r\n\r\n      if (navigator.onLine) {\r\n        // Online: Perform action immediately\r\n        if (isFavorite) {\r\n          await this.model.removeFavorite(storyId);\r\n          this._showToast(\"Removed from favorites\", \"success\");\r\n        } else {\r\n          await this.model.addFavorite(storyData);\r\n          this._showToast(\"Added to favorites\", \"success\");\r\n        }\r\n\r\n        // Update button state\r\n        await this._updateFavoriteButtonState(storyId);\r\n      } else {\r\n        // Offline: Queue action\r\n        await this._queueOfflineAction(\r\n          isFavorite ? \"remove\" : \"add\",\r\n          storyId,\r\n          storyData\r\n        );\r\n        this._showToast(\"Action queued for when you're back online\", \"info\");\r\n\r\n        // Update UI optimistically\r\n        this.view.updateFavoriteButton(storyId, !isFavorite);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error toggling favorite:\", error);\r\n      this._showToast(\"Failed to update favorite\", \"error\");\r\n    }\r\n  }\r\n\r\n  async _queueOfflineAction(action, storyId, storyData = null) {\r\n    const pendingActions = JSON.parse(\r\n      localStorage.getItem(\"pending_favorite_actions\") || \"[]\"\r\n    );\r\n\r\n    // Remove any existing actions for this story to avoid conflicts\r\n    const filteredActions = pendingActions.filter((a) => a.storyId !== storyId);\r\n\r\n    // Add new action\r\n    filteredActions.push({\r\n      action,\r\n      storyId,\r\n      storyData,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    localStorage.setItem(\r\n      \"pending_favorite_actions\",\r\n      JSON.stringify(filteredActions)\r\n    );\r\n  }\r\n\r\n  async _syncPendingActions() {\r\n    try {\r\n      const pendingActions = JSON.parse(\r\n        localStorage.getItem(\"pending_favorite_actions\") || \"[]\"\r\n      );\r\n\r\n      if (pendingActions.length === 0) return;\r\n\r\n      console.log(\"Syncing pending favorite actions:\", pendingActions.length);\r\n\r\n      for (const action of pendingActions) {\r\n        try {\r\n          if (action.action === \"add\" && action.storyData) {\r\n            await this.model.addFavorite(action.storyData);\r\n          } else if (action.action === \"remove\") {\r\n            await this.model.removeFavorite(action.storyId);\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Error syncing action:\", action, error);\r\n        }\r\n      }\r\n\r\n      // Clear synced actions\r\n      localStorage.removeItem(\"pending_favorite_actions\");\r\n\r\n      // Update current story's favorite state if still viewing it\r\n      if (this.currentStoryId) {\r\n        await this._updateFavoriteButtonState(this.currentStoryId);\r\n      }\r\n\r\n      this._showToast(\"Favorites synced successfully\", \"success\");\r\n    } catch (error) {\r\n      console.error(\"Error syncing pending actions:\", error);\r\n    }\r\n  }\r\n\r\n  _showToast(message, type = \"info\") {\r\n    // Remove existing toasts\r\n    const existingToasts = document.querySelectorAll(\".toast\");\r\n    existingToasts.forEach((toast) => toast.remove());\r\n\r\n    // Create new toast\r\n    const toast = document.createElement(\"div\");\r\n    toast.className = `toast toast-${type}`;\r\n    toast.innerHTML = `\r\n      <span>${message}</span>\r\n      <button class=\"toast-close\">&times;</button>\r\n    `;\r\n\r\n    // Add to page\r\n    document.body.appendChild(toast);\r\n\r\n    // Auto-remove after 3 seconds\r\n    setTimeout(() => {\r\n      if (toast.parentNode) {\r\n        toast.remove();\r\n      }\r\n    }, 3000);\r\n\r\n    // Add click to close\r\n    const closeBtn = toast.querySelector(\".toast-close\");\r\n    if (closeBtn) {\r\n      closeBtn.addEventListener(\"click\", () => toast.remove());\r\n    }\r\n  }\r\n}\r\n\r\nexport default StoryDetailPresenter;\r\n","import NotificationHelper from \"../scripts/notification-helper-new.js\";\r\n\r\nclass AddStoryPresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n    this.notificationHelper = new NotificationHelper();\r\n    this._initListener();\r\n  }\r\n  async init() {\r\n    this.view.render();\r\n\r\n    // Initialize notifications when add story page loads\r\n    try {\r\n      await this.notificationHelper.init();\r\n      console.log(\"Notification helper initialized for add story page\");\r\n\r\n      // Request permission explicitly if not granted\r\n      if (Notification.permission === \"default\") {\r\n        console.log(\"Requesting notification permission...\");\r\n        const permission = await this.notificationHelper.requestPermission();\r\n        console.log(\"Permission result:\", permission);\r\n      }\r\n    } catch (error) {\r\n      console.warn(\"Failed to initialize notifications:\", error);\r\n    }\r\n  }\r\n  _initListener() {\r\n    document.addEventListener(\"story:submit\", async (event) => {\r\n      try {\r\n        const { formData } = event.detail;\r\n        console.log(\"Submitting story:\", formData.get(\"description\"));\r\n\r\n        const result = await this.model.addStory(formData);\r\n        console.log(\"Story submission result:\", result);\r\n\r\n        // Show notification if story was created successfully\r\n        if (!result.error) {\r\n          try {\r\n            console.log(\"Attempting to show notification...\");\r\n            const storyData = {\r\n              id: result.id || Date.now(),\r\n              description: formData.get(\"description\"),\r\n              photoUrl: result.photoUrl || \"default-image\",\r\n            }; // Simplified notification approach - same as test notification\r\n            try {\r\n              console.log(\"Attempting to show story notification...\");\r\n\r\n              if (Notification.permission === \"granted\") {\r\n                const notification = new Notification(\"Story berhasil dibuat\", {\r\n                  body: `Anda telah membuat story baru dengan deskripsi: ${storyData.description}`,\r\n                  icon: \"/icons/app-icon.svg\",\r\n                });\r\n\r\n                notification.onclick = function () {\r\n                  console.log(\"Story notification clicked\");\r\n                  notification.close();\r\n                  // Optional: navigate to story detail\r\n                  // window.location.hash = `#/story/${storyData.id}`;\r\n                };\r\n\r\n                console.log(\"Story notification sent successfully\");\r\n              } else {\r\n                console.warn(\r\n                  \"Notification permission not granted:\",\r\n                  Notification.permission\r\n                );\r\n              }\r\n            } catch (notificationError) {\r\n              console.error(\r\n                \"Failed to show story notification:\",\r\n                notificationError\r\n              );\r\n            }\r\n          } catch (notificationError) {\r\n            console.error(\"Failed to show notification:\", notificationError);\r\n            // Don't let notification errors affect the main flow\r\n          }\r\n        }\r\n\r\n        console.log(\"Calling view.showSubmitResult with:\", result);\r\n        this.view.showSubmitResult(result);\r\n        console.log(\"showSubmitResult called successfully\");\r\n      } catch (error) {\r\n        console.error(\"Error submitting story:\", error);\r\n        this.view.showSubmitResult({ error: true, message: error.message });\r\n      }\r\n    });\r\n  }\r\n\r\n  cleanup() {\r\n    // Remove event listeners to prevent memory leaks\r\n    document.removeEventListener(\"story:submit\", this._handleSubmit);\r\n    // Clean up view resources\r\n    this.view.cleanup();\r\n  }\r\n}\r\n\r\nexport default AddStoryPresenter;\r\n","class AuthPresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n    this._initListener();\r\n  }\r\n  renderLogin() {\r\n    this.view.renderLogin();\r\n    return document.getElementById(\"login-form\") !== null;\r\n  }\r\n\r\n  renderRegister() {\r\n    this.view.renderRegister();\r\n    return document.getElementById(\"register-form\") !== null;\r\n  }\r\n\r\n  ensureFormRendered(formType) {\r\n    if (formType === \"login\" && !document.getElementById(\"login-form\")) {\r\n      return this.renderLogin();\r\n    } else if (\r\n      formType === \"register\" &&\r\n      !document.getElementById(\"register-form\")\r\n    ) {\r\n      return this.renderRegister();\r\n    }\r\n    return true;\r\n  }\r\n  _initListener() {\r\n    document.addEventListener(\"auth:login\", async (event) => {\r\n      try {\r\n        const { email, password } = event.detail;\r\n        const result = await this.model.login(email, password);\r\n\r\n        // Make sure login view is rendered and retry if not\r\n        let retryCount = 0;\r\n        const maxRetries = 3;\r\n        let formRendered = this.ensureFormRendered(\"login\");\r\n\r\n        const processResult = () => {\r\n          if (formRendered) {\r\n            this.view.showAuthResult(result, \"login\");\r\n\r\n            if (!result.error) {\r\n              // Update UI based on login status\r\n              this._updateNavbar();\r\n            }\r\n          } else if (retryCount < maxRetries) {\r\n            retryCount++;\r\n            console.log(\r\n              `Retrying to render login form (attempt ${retryCount})`\r\n            );\r\n            setTimeout(() => {\r\n              formRendered = this.ensureFormRendered(\"login\");\r\n              processResult();\r\n            }, 200);\r\n          } else {\r\n            console.error(\r\n              \"Failed to render login form after multiple attempts\"\r\n            );\r\n            // Fallback to redirect\r\n            if (!result.error) {\r\n              window.location.hash = \"#/\";\r\n            }\r\n          }\r\n        };\r\n\r\n        // Start processing with small delay to ensure DOM update\r\n        setTimeout(processResult, 100);\r\n      } catch (error) {\r\n        console.error(\"Login error:\", error);\r\n\r\n        // Make sure login view is rendered\r\n        const formRendered = this.ensureFormRendered(\"login\");\r\n\r\n        // Process with small timeout\r\n        setTimeout(() => {\r\n          if (formRendered) {\r\n            this.view.showAuthResult(\r\n              { error: true, message: error.message },\r\n              \"login\"\r\n            );\r\n          } else {\r\n            console.error(\"Failed to render login form to show error\");\r\n            alert(`Login error: ${error.message}`);\r\n          }\r\n        }, 100);\r\n      }\r\n    });\r\n    document.addEventListener(\"auth:register\", async (event) => {\r\n      try {\r\n        const { name, email, password } = event.detail;\r\n        const result = await this.model.register(name, email, password);\r\n\r\n        // Make sure register view is rendered and retry if not\r\n        let retryCount = 0;\r\n        const maxRetries = 3;\r\n        let formRendered = this.ensureFormRendered(\"register\");\r\n\r\n        const processResult = () => {\r\n          if (formRendered) {\r\n            this.view.showAuthResult(result, \"register\");\r\n          } else if (retryCount < maxRetries) {\r\n            retryCount++;\r\n            console.log(\r\n              `Retrying to render register form (attempt ${retryCount})`\r\n            );\r\n            setTimeout(() => {\r\n              formRendered = this.ensureFormRendered(\"register\");\r\n              processResult();\r\n            }, 200);\r\n          } else {\r\n            console.error(\r\n              \"Failed to render register form after multiple attempts\"\r\n            );\r\n            // Fallback to show message\r\n            if (!result.error) {\r\n              alert(\"Registration successful! Please log in.\");\r\n              window.location.hash = \"#/login\";\r\n            }\r\n          }\r\n        };\r\n\r\n        // Start processing with small delay to ensure DOM update\r\n        setTimeout(processResult, 100);\r\n      } catch (error) {\r\n        console.error(\"Registration error:\", error);\r\n\r\n        // Make sure register view is rendered\r\n        const formRendered = this.ensureFormRendered(\"register\");\r\n\r\n        // Process with small timeout\r\n        setTimeout(() => {\r\n          if (formRendered) {\r\n            this.view.showAuthResult(\r\n              { error: true, message: error.message },\r\n              \"register\"\r\n            );\r\n          } else {\r\n            console.error(\"Failed to render register form to show error\");\r\n            alert(`Registration error: ${error.message}`);\r\n          }\r\n        }, 100);\r\n      }\r\n    });\r\n  }\r\n\r\n  _updateNavbar() {\r\n    const loginLink = document.getElementById(\"loginLink\");\r\n\r\n    if (this.model.isLoggedIn()) {\r\n      const name = localStorage.getItem(\"name\");\r\n      loginLink.innerHTML = `<i class=\"fas fa-sign-out-alt\"></i> Logout (${name})`;\r\n      loginLink.href = \"#/logout\";\r\n    } else {\r\n      loginLink.innerHTML = `<i class=\"fas fa-sign-in-alt\"></i> Login`;\r\n      loginLink.href = \"#/login\";\r\n    }\r\n  }\r\n}\r\n\r\nexport default AuthPresenter;\r\n","class MapPresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n  }\r\n\r\n  async init() {\r\n    try {\r\n      // Check if user is logged in\r\n      if (this.model.isLoggedIn()) {\r\n        // Fetch stories with location\r\n        const result = await this.model.getStories(1, 50, 1);\r\n\r\n        if (!result.error) {\r\n          // Only show stories with location data\r\n          const storiesWithLocation = result.listStory.filter(\r\n            (story) => story.lat && story.lon\r\n          );\r\n          this.view.render(storiesWithLocation);\r\n        } else {\r\n          console.error(\"Failed to fetch stories for map:\", result.message);\r\n          this.view.render([]);\r\n        }\r\n      } else {\r\n        // Redirect to login if not logged in\r\n        window.location.hash = \"#/login\";\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error initializing map page:\", error);\r\n      this.view.render([]);\r\n    }\r\n  }\r\n}\r\n\r\nexport default MapPresenter;\r\n","class FavoritesPresenter {\r\n  constructor({ view, model }) {\r\n    this.view = view;\r\n    this.model = model;\r\n    this.favorites = [];\r\n    this.pendingOfflineActions = [];\r\n\r\n    this._attachEventListeners();\r\n  }\r\n\r\n  _attachEventListeners() {\r\n    // Listen for favorite toggle events from view\r\n    document.addEventListener(\"favorite:toggle\", async (e) => {\r\n      await this._handleFavoriteToggle(e.detail.storyId);\r\n    });\r\n\r\n    // Listen for online/offline events to handle pending actions\r\n    window.addEventListener(\"online\", () => {\r\n      this._processPendingOfflineActions();\r\n    });\r\n  }\r\n\r\n  async init() {\r\n    try {\r\n      console.log(\"Initializing Favorites page...\");\r\n\r\n      // Show loading state\r\n      this.view.showLoadingState();\r\n\r\n      // Load favorites from IndexedDB (always available offline)\r\n      this.favorites = await this.model.getFavorites();\r\n      console.log(\"Loaded favorites:\", this.favorites);\r\n\r\n      // Render favorites\r\n      this.view.render(this.favorites);\r\n\r\n      // If online, sync any pending actions\r\n      if (navigator.onLine) {\r\n        await this._processPendingOfflineActions();\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error initializing favorites:\", error);\r\n      this.view.showError(\"Failed to load favorites. Please try again.\");\r\n    }\r\n  }\r\n\r\n  async _handleFavoriteToggle(storyId) {\r\n    try {\r\n      console.log(\"Toggling favorite for story:\", storyId);\r\n\r\n      // Check if story is currently in favorites\r\n      const isFavorited = this.favorites.some((fav) => fav.id === storyId);\r\n\r\n      if (isFavorited) {\r\n        // Remove from favorites\r\n        await this._removeFavorite(storyId);\r\n      } else {\r\n        // This shouldn't happen in favorites page, but handle anyway\r\n        console.warn(\"Story not in favorites list, cannot remove\");\r\n        this.view.showToast(\"Story not found in favorites\", \"error\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error toggling favorite:\", error);\r\n      this.view.showToast(\"Failed to update favorite\", \"error\");\r\n    }\r\n  }\r\n\r\n  async _removeFavorite(storyId) {\r\n    try {\r\n      // If offline, queue the action\r\n      if (!navigator.onLine) {\r\n        this._queueOfflineAction(\"remove\", storyId);\r\n        this.view.showToast(\"Favorite will be updated when online\", \"success\");\r\n      } else {\r\n        // Remove from IndexedDB immediately\r\n        await this.model.removeFromFavorites(storyId);\r\n        this.view.showToast(\"Removed from favorites\", \"success\");\r\n      }\r\n\r\n      // Update local state\r\n      this.favorites = this.favorites.filter((fav) => fav.id !== storyId);\r\n\r\n      // Update view\r\n      this.view.removeFavoriteFromView(storyId);\r\n    } catch (error) {\r\n      console.error(\"Error removing favorite:\", error);\r\n      this.view.showToast(\"Failed to remove favorite\", \"error\");\r\n    }\r\n  }\r\n\r\n  _queueOfflineAction(action, storyId, storyData = null) {\r\n    const offlineAction = {\r\n      id: Date.now(),\r\n      action,\r\n      storyId,\r\n      storyData,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    this.pendingOfflineActions.push(offlineAction);\r\n\r\n    // Save to localStorage for persistence\r\n    localStorage.setItem(\r\n      \"pending_favorite_actions\",\r\n      JSON.stringify(this.pendingOfflineActions)\r\n    );\r\n\r\n    console.log(\"Queued offline action:\", offlineAction);\r\n  }\r\n\r\n  async _processPendingOfflineActions() {\r\n    try {\r\n      // Load pending actions from localStorage\r\n      const savedActions = localStorage.getItem(\"pending_favorite_actions\");\r\n      if (savedActions) {\r\n        this.pendingOfflineActions = JSON.parse(savedActions);\r\n      }\r\n\r\n      if (this.pendingOfflineActions.length === 0) {\r\n        return;\r\n      }\r\n\r\n      console.log(\r\n        \"Processing pending offline actions:\",\r\n        this.pendingOfflineActions\r\n      );\r\n\r\n      const processedActions = [];\r\n\r\n      for (const action of this.pendingOfflineActions) {\r\n        try {\r\n          if (action.action === \"add\") {\r\n            await this.model.addToFavorites(action.storyData);\r\n            console.log(\r\n              \"Synced add favorite action for story:\",\r\n              action.storyId\r\n            );\r\n          } else if (action.action === \"remove\") {\r\n            await this.model.removeFromFavorites(action.storyId);\r\n            console.log(\r\n              \"Synced remove favorite action for story:\",\r\n              action.storyId\r\n            );\r\n          }\r\n\r\n          processedActions.push(action.id);\r\n        } catch (error) {\r\n          console.error(\"Error processing offline action:\", action, error);\r\n        }\r\n      }\r\n\r\n      // Remove processed actions\r\n      this.pendingOfflineActions = this.pendingOfflineActions.filter(\r\n        (action) => !processedActions.includes(action.id)\r\n      );\r\n\r\n      // Update localStorage\r\n      if (this.pendingOfflineActions.length === 0) {\r\n        localStorage.removeItem(\"pending_favorite_actions\");\r\n      } else {\r\n        localStorage.setItem(\r\n          \"pending_favorite_actions\",\r\n          JSON.stringify(this.pendingOfflineActions)\r\n        );\r\n      }\r\n\r\n      if (processedActions.length > 0) {\r\n        console.log(\r\n          `Synced ${processedActions.length} pending favorite actions`\r\n        );\r\n        this.view.showToast(\r\n          `Synced ${processedActions.length} pending changes`,\r\n          \"success\"\r\n        );\r\n\r\n        // Refresh favorites after sync\r\n        await this.refreshFavorites();\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error processing pending offline actions:\", error);\r\n    }\r\n  }\r\n\r\n  async refreshFavorites() {\r\n    try {\r\n      this.favorites = await this.model.getFavorites();\r\n      this.view.render(this.favorites);\r\n    } catch (error) {\r\n      console.error(\"Error refreshing favorites:\", error);\r\n    }\r\n  }\r\n\r\n  // Method to add favorite from other pages\r\n  async addFavorite(story) {\r\n    try {\r\n      console.log(\"Adding story to favorites:\", story.id);\r\n\r\n      // If offline, queue the action\r\n      if (!navigator.onLine) {\r\n        this._queueOfflineAction(\"add\", story.id, story);\r\n        return { success: true, offline: true };\r\n      } else {\r\n        // Add to IndexedDB\r\n        await this.model.addToFavorites(story);\r\n        return { success: true, offline: false };\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding favorite:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  // Method to remove favorite from other pages\r\n  async removeFavorite(storyId) {\r\n    try {\r\n      console.log(\"Removing story from favorites:\", storyId);\r\n\r\n      // If offline, queue the action\r\n      if (!navigator.onLine) {\r\n        this._queueOfflineAction(\"remove\", storyId);\r\n        return { success: true, offline: true };\r\n      } else {\r\n        // Remove from IndexedDB\r\n        await this.model.removeFromFavorites(storyId);\r\n        return { success: true, offline: false };\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error removing favorite:\", error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  // Method to check if story is favorite\r\n  async isFavorite(storyId) {\r\n    try {\r\n      return await this.model.isFavorite(storyId);\r\n    } catch (error) {\r\n      console.error(\"Error checking favorite status:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Cleanup method\r\n  cleanup() {\r\n    // Remove event listeners if needed\r\n    // Currently using document listeners which persist\r\n  }\r\n}\r\n\r\nexport default FavoritesPresenter;\r\n","// Import CSS\r\nimport \"../styles/style.css\";\r\n\r\n// Import Models\r\nimport StoryModel from \"../models/story-model.js\";\r\n\r\n// Import Views\r\nimport HomeView from \"../views/home-view.js\";\r\nimport StoryDetailView from \"../views/story-detail-view.js\";\r\nimport AddStoryView from \"../views/add-story-view.js\";\r\nimport AuthView from \"../views/auth-view.js\";\r\nimport MapView from \"../views/map-view.js\";\r\nimport FavoritesView from \"../views/favorites-view.js\";\r\nimport NotFoundView from \"../views/not-found-view.js\";\r\n\r\n// Import Helpers\r\nimport NotificationHelper from \"./notification-helper-new.js\";\r\nimport { IndexedDBHelper } from \"./indexeddb-helper.js\";\r\n\r\n// Import PWA utilities\r\nimport { registerSW } from \"virtual:pwa-register\";\r\n\r\n// Import Presenters\r\nimport HomePresenter from \"../presenters/home-presenter.js\";\r\nimport StoryDetailPresenter from \"../presenters/story-detail-presenter.js\";\r\nimport AddStoryPresenter from \"../presenters/add-story-presenter.js\";\r\nimport AuthPresenter from \"../presenters/auth-presenter.js\";\r\nimport MapPresenter from \"../presenters/map-presenter.js\";\r\nimport FavoritesPresenter from \"../presenters/favorites-presenter.js\";\r\n\r\nclass App {\r\n  constructor() {\r\n    // Initialize the model\r\n    this.model = new StoryModel();\r\n\r\n    // Initialize helpers\r\n    this.notificationHelper = new NotificationHelper();\r\n    this.dbHelper = new IndexedDBHelper(); // Initialize views\r\n    this.homeView = new HomeView();\r\n    this.storyDetailView = new StoryDetailView();\r\n    this.addStoryView = new AddStoryView();\r\n    this.authView = new AuthView();\r\n    this.mapView = new MapView();\r\n    this.favoritesView = new FavoritesView();\r\n    this.notFoundView = new NotFoundView();\r\n\r\n    // Initialize presenters\r\n    this.homePresenter = new HomePresenter({\r\n      view: this.homeView,\r\n      model: this.model,\r\n    });\r\n\r\n    this.storyDetailPresenter = new StoryDetailPresenter({\r\n      view: this.storyDetailView,\r\n      model: this.model,\r\n    });\r\n\r\n    this.addStoryPresenter = new AddStoryPresenter({\r\n      view: this.addStoryView,\r\n      model: this.model,\r\n    });\r\n\r\n    this.authPresenter = new AuthPresenter({\r\n      view: this.authView,\r\n      model: this.model,\r\n    });\r\n    this.mapPresenter = new MapPresenter({\r\n      view: this.mapView,\r\n      model: this.model,\r\n    });\r\n\r\n    this.favoritesPresenter = new FavoritesPresenter({\r\n      view: this.favoritesView,\r\n      model: this.model,\r\n    });\r\n\r\n    // Add event listener for URL hash changes\r\n    window.addEventListener(\"hashchange\", () => {\r\n      this.urlRouting();\r\n    });\r\n\r\n    // Add event listener for user login to initialize notifications\r\n    document.addEventListener(\"user:loggedIn\", async () => {\r\n      console.log(\"User logged in, initializing notifications...\");\r\n      try {\r\n        await this.notificationHelper.init();\r\n        console.log(\"Notifications initialized after login\");\r\n      } catch (error) {\r\n        console.warn(\"Failed to initialize notifications after login:\", error);\r\n      }\r\n    });\r\n\r\n    // Initialize PWA features\r\n    this.initPWA();\r\n\r\n    // Add online/offline event listeners\r\n    this.setupOnlineOfflineListeners();\r\n\r\n    // Call routing function to handle initial URL\r\n    this.urlRouting();\r\n\r\n    // Update navbar based on auth status\r\n    this.updateNavbar();\r\n  }\r\n  urlRouting() {\r\n    // Prevent multiple routing operations from running simultaneously\r\n    if (this.isRouting) {\r\n      console.log(\"Routing already in progress, skipping\");\r\n      return;\r\n    }\r\n\r\n    this.isRouting = true;\r\n\r\n    // Use View Transition API for smooth page transitions if supported\r\n    if (document.startViewTransition) {\r\n      try {\r\n        document.startViewTransition(() => {\r\n          this._handleRouting();\r\n          this.isRouting = false;\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Error in view transition:\", error);\r\n        this._handleRouting();\r\n        this.isRouting = false;\r\n      }\r\n    } else {\r\n      this._handleRouting();\r\n      this.isRouting = false;\r\n    }\r\n  }\r\n  _handleRouting() {\r\n    try {\r\n      const hash = window.location.hash || \"#/\";\r\n      console.log(\"Routing to:\", hash);\r\n\r\n      // Clean up any active presenter resources\r\n      if (this.currentPresenter === this.addStoryPresenter) {\r\n        try {\r\n          this.addStoryPresenter.cleanup();\r\n        } catch (error) {\r\n          console.error(\"Error cleaning up add story presenter:\", error);\r\n        }\r\n      }\r\n\r\n      if (hash.startsWith(\"#/story/\")) {\r\n        // Story detail page\r\n        const storyId = hash.substring(\"#/story/\".length);\r\n        if (!storyId) {\r\n          console.error(\"Invalid story ID in URL\");\r\n          window.location.hash = \"#/\";\r\n          return;\r\n        }\r\n        this.storyDetailPresenter.init(storyId);\r\n        this.currentPresenter = this.storyDetailPresenter;\r\n      } else if (hash === \"#/add\") {\r\n        // Add story page - require authentication\r\n        if (!this.model.isLoggedIn()) {\r\n          window.location.hash = \"#/login\";\r\n          return;\r\n        }\r\n        this.addStoryPresenter.init();\r\n        this.currentPresenter = this.addStoryPresenter;\r\n      } else if (hash === \"#/login\") {\r\n        // Login page\r\n        this.authPresenter.renderLogin();\r\n        this.currentPresenter = this.authPresenter;\r\n      } else if (hash === \"#/register\") {\r\n        // Register page\r\n        this.authPresenter.renderRegister();\r\n        this.currentPresenter = this.authPresenter;\r\n      } else if (hash === \"#/logout\") {\r\n        // Logout action\r\n        this.model.logout();\r\n        this.updateNavbar();\r\n        window.location.hash = \"#/login\";\r\n      } else if (hash === \"#/map\" || hash === \"#map\") {\r\n        // Map page\r\n        console.log(\"Initializing map page\");\r\n        try {\r\n          this.mapPresenter.init();\r\n          this.currentPresenter = this.mapPresenter;\r\n          console.log(\"Map presenter initialized successfully\");\r\n        } catch (error) {\r\n          console.error(\"Error initializing map presenter:\", error);\r\n        }\r\n      } else if (hash === \"#/favorites\") {\r\n        // Favorites page - require authentication\r\n        if (!this.model.isLoggedIn()) {\r\n          window.location.hash = \"#/login\";\r\n          return;\r\n        }\r\n        console.log(\"Initializing favorites page\");\r\n        try {\r\n          this.favoritesPresenter.init();\r\n          this.currentPresenter = this.favoritesPresenter;\r\n          console.log(\"Favorites presenter initialized successfully\");\r\n        } catch (error) {\r\n          console.error(\"Error initializing favorites presenter:\", error);\r\n        }\r\n      } else if (hash === \"#home\" || hash === \"#/\" || hash === \"\") {\r\n        // Home page\r\n        if (this.model.isLoggedIn()) {\r\n          this.homePresenter.init();\r\n          this.currentPresenter = this.homePresenter;\r\n        } else {\r\n          // Redirect to login if not logged in\r\n          window.location.hash = \"#/login\";\r\n        }\r\n      } else {\r\n        // Unknown route - show 404 page\r\n        console.log(\"Unknown route:\", hash);\r\n        this.notFoundView.show();\r\n        this.currentPresenter = null;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error in routing:\", error);\r\n      // Fallback to login page on error\r\n      try {\r\n        this.authPresenter.renderLogin();\r\n        this.currentPresenter = this.authPresenter;\r\n      } catch (e) {\r\n        console.error(\"Failed to navigate to login page:\", e);\r\n        document.getElementById(\"app-container\").innerHTML = `\r\n          <div class=\"alert alert-danger\">\r\n            <p><i class=\"fas fa-exclamation-circle\"></i> An error occurred. Please try refreshing the page.</p>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n  }\r\n  updateNavbar() {\r\n    const loginLink = document.getElementById(\"loginLink\");\r\n    const favoritesLink = document.getElementById(\"favoritesLink\");\r\n\r\n    if (this.model.isLoggedIn()) {\r\n      const name = localStorage.getItem(\"name\");\r\n      loginLink.innerHTML = `<i class=\"fas fa-sign-out-alt\"></i> Logout (${name})`;\r\n      loginLink.href = \"#/logout\";\r\n\r\n      // Show favorites link when logged in\r\n      if (favoritesLink) {\r\n        favoritesLink.style.display = \"block\";\r\n      }\r\n\r\n      // Initialize push notifications if supported\r\n      this._initPushNotification();\r\n    } else {\r\n      loginLink.innerHTML = `<i class=\"fas fa-sign-in-alt\"></i> Login`;\r\n      loginLink.href = \"#/login\";\r\n\r\n      // Hide favorites link when not logged in\r\n      if (favoritesLink) {\r\n        favoritesLink.style.display = \"none\";\r\n      }\r\n    }\r\n  }\r\n  async _initPushNotification() {\r\n    try {\r\n      if (this.notificationHelper.isPushNotificationSupported()) {\r\n        await this.notificationHelper.registerServiceWorker();\r\n        const subscription = await this.notificationHelper.getSubscription();\r\n\r\n        if (!subscription) {\r\n          // Ask user to subscribe to notifications if not already subscribed\r\n          const confirmSubscribe = confirm(\r\n            \"Would you like to receive notifications when new stories are posted?\"\r\n          );\r\n\r\n          if (confirmSubscribe) {\r\n            try {\r\n              await this.notificationHelper.subscribeNotification();\r\n              console.log(\"User successfully subscribed to notifications\");\r\n            } catch (subError) {\r\n              console.error(\"Error subscribing to notifications:\", subError);\r\n              // Do not show error to user as notifications are optional\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error initializing push notifications:\", error);\r\n      // Notifications are not critical for app functionality, so continue silently\r\n    }\r\n  }\r\n  // PWA Initialization\r\n  async initPWA() {\r\n    try {\r\n      // Initialize IndexedDB\r\n      await this.dbHelper.initDB();\r\n      console.log(\"IndexedDB initialized\");\r\n\r\n      // Initialize notifications\r\n      const notificationSuccess = await this.notificationHelper.init();\r\n      if (notificationSuccess) {\r\n        console.log(\"Push notifications initialized\");\r\n\r\n        // Show welcome notification\r\n        await this.notificationHelper.showWelcomeNotification();\r\n      }\r\n\r\n      // Register service worker with VitePWA\r\n      this.registerServiceWorker();\r\n\r\n      // Check for app updates\r\n      this.checkForUpdates();\r\n\r\n      // Setup PWA install prompt\r\n      this.setupInstallPrompt();\r\n\r\n      // Check PWA install status\r\n      this.checkPWAInstallStatus();\r\n    } catch (error) {\r\n      console.error(\"Error initializing PWA features:\", error);\r\n    }\r\n  }\r\n\r\n  registerServiceWorker() {\r\n    const updateSW = registerSW({\r\n      onNeedRefresh() {\r\n        console.log(\"New version available\");\r\n        // Show update notification\r\n        document.dispatchEvent(new CustomEvent(\"sw-update-available\"));\r\n      },\r\n      onOfflineReady() {\r\n        console.log(\"App ready to work offline\");\r\n        // Show offline ready notification\r\n        document.dispatchEvent(new CustomEvent(\"sw-offline-ready\"));\r\n      },\r\n    });\r\n\r\n    // Listen for update events\r\n    document.addEventListener(\"sw-update-available\", () => {\r\n      this.showUpdateAvailable();\r\n    });\r\n\r\n    document.addEventListener(\"sw-offline-ready\", () => {\r\n      this.showOfflineReady();\r\n    });\r\n  }\r\n\r\n  setupOnlineOfflineListeners() {\r\n    window.addEventListener(\"online\", async () => {\r\n      console.log(\"App is back online\");\r\n\r\n      // Show simple online notification\r\n      try {\r\n        if (Notification.permission === \"granted\") {\r\n          new Notification(\"Back Online\", {\r\n            body: \"You are back online. Syncing your offline stories...\",\r\n            icon: \"/icons/app-icon.svg\",\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error showing online notification:\", error);\r\n      }\r\n\r\n      // Sync offline stories\r\n      await this.syncOfflineData();\r\n\r\n      // Update UI\r\n      this.updateOnlineStatus(true);\r\n\r\n      // Refresh current page if we're on home page\r\n      if (window.location.hash === \"#/\" || window.location.hash === \"\") {\r\n        console.log(\"Refreshing home page after sync\");\r\n        setTimeout(() => {\r\n          this.loadPage();\r\n        }, 1000);\r\n      }\r\n    });\r\n    window.addEventListener(\"offline\", async () => {\r\n      console.log(\"App is offline\");\r\n\r\n      // Show simple offline notification\r\n      try {\r\n        if (Notification.permission === \"granted\") {\r\n          new Notification(\"You are Offline\", {\r\n            body: \"You can still add stories. They will be synced when you're back online.\",\r\n            icon: \"/icons/app-icon.svg\",\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error showing offline notification:\", error);\r\n      }\r\n\r\n      // Update UI\r\n      this.updateOnlineStatus(false);\r\n    });\r\n  }\r\n\r\n  async syncOfflineData() {\r\n    try {\r\n      const syncedCount = await this.model.syncOfflineStories();\r\n      if (syncedCount > 0) {\r\n        console.log(`Synced ${syncedCount} offline stories`);\r\n\r\n        // Show notification about sync\r\n        if (\"Notification\" in window && Notification.permission === \"granted\") {\r\n          new Notification(\"Stories Synced\", {\r\n            body: `${syncedCount} offline stories have been synced`,\r\n            icon: \"/icons/icon-144x144.svg\",\r\n            badge: \"/icons/icon-144x144.svg\",\r\n          });\r\n        }\r\n\r\n        // Refresh current view if on home page\r\n        if (window.location.hash === \"\" || window.location.hash === \"#home\") {\r\n          this.homePresenter.init();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error syncing offline data:\", error);\r\n    }\r\n  }\r\n\r\n  updateOnlineStatus(isOnline) {\r\n    // Add or remove offline indicator\r\n    const existingIndicator = document.querySelector(\".offline-indicator\");\r\n\r\n    if (!isOnline && !existingIndicator) {\r\n      const indicator = document.createElement(\"div\");\r\n      indicator.className = \"offline-indicator\";\r\n      indicator.innerHTML = '<i class=\"fas fa-wifi\"></i> You are offline';\r\n      indicator.style.cssText = `\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        background: #ff9800;\r\n        color: white;\r\n        text-align: center;\r\n        padding: 8px;\r\n        z-index: 10000;\r\n        font-size: 14px;\r\n      `;\r\n      document.body.prepend(indicator);\r\n    } else if (isOnline && existingIndicator) {\r\n      existingIndicator.remove();\r\n    }\r\n  }\r\n  showUpdateAvailable() {\r\n    // Show update notification\r\n    const updateBanner = document.createElement(\"div\");\r\n    updateBanner.className = \"update-banner\";\r\n    updateBanner.innerHTML = `\r\n      <div style=\"background: #4CAF50; color: white; padding: 12px; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 10001;\">\r\n        <span>A new version is available!</span>\r\n        <button onclick=\"window.location.reload()\" style=\"margin-left: 10px; background: white; color: #4CAF50; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;\">\r\n          Update Now\r\n        </button>\r\n        <button onclick=\"this.parentElement.parentElement.remove()\" style=\"margin-left: 5px; background: transparent; color: white; border: 1px solid white; padding: 4px 8px; border-radius: 4px; cursor: pointer;\">\r\n          Later\r\n        </button>\r\n      </div>\r\n    `;\r\n    document.body.prepend(updateBanner);\r\n  }\r\n\r\n  showOfflineReady() {\r\n    // Show offline ready notification\r\n    const offlineBanner = document.createElement(\"div\");\r\n    offlineBanner.className = \"offline-ready-banner\";\r\n    offlineBanner.innerHTML = `\r\n      <div style=\"background: #2196F3; color: white; padding: 12px; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 10001;\">\r\n        <span><i class=\"fas fa-wifi-slash\"></i> App is ready to work offline!</span>\r\n        <button onclick=\"this.parentElement.parentElement.remove()\" style=\"margin-left: 10px; background: transparent; color: white; border: 1px solid white; padding: 4px 8px; border-radius: 4px; cursor: pointer;\">\r\n          Got it\r\n        </button>\r\n      </div>\r\n    `;\r\n    document.body.prepend(offlineBanner);\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => {\r\n      if (offlineBanner.parentElement) {\r\n        offlineBanner.remove();\r\n      }\r\n    }, 5000);\r\n  }\r\n  checkForUpdates() {\r\n    // VitePWA handles updates automatically through the registerSW callback\r\n    // This method can be used for any additional update checking logic\r\n    console.log(\"Update checking is handled by VitePWA registerSW\");\r\n  }\r\n\r\n  // PWA Install functionality\r\n  setupInstallPrompt() {\r\n    let deferredPrompt;\r\n    const installButton = document.createElement(\"button\");\r\n    installButton.className = \"install-pwa\";\r\n    installButton.innerHTML = '<i class=\"fas fa-download\"></i> Install App';\r\n    installButton.style.display = \"none\";\r\n    document.body.appendChild(installButton);\r\n\r\n    // Listen for beforeinstallprompt event\r\n    window.addEventListener(\"beforeinstallprompt\", (e) => {\r\n      console.log(\"PWA install prompt available\");\r\n      e.preventDefault();\r\n      deferredPrompt = e;\r\n\r\n      // Show install button\r\n      installButton.classList.add(\"show\");\r\n    });\r\n\r\n    // Handle install button click\r\n    installButton.addEventListener(\"click\", async () => {\r\n      if (deferredPrompt) {\r\n        deferredPrompt.prompt();\r\n        const { outcome } = await deferredPrompt.userChoice;\r\n        console.log(`PWA install outcome: ${outcome}`);\r\n\r\n        if (outcome === \"accepted\") {\r\n          console.log(\"User accepted PWA install\");\r\n        } else {\r\n          console.log(\"User dismissed PWA install\");\r\n        }\r\n\r\n        deferredPrompt = null;\r\n        installButton.classList.remove(\"show\");\r\n      }\r\n    });\r\n\r\n    // Listen for app installed event\r\n    window.addEventListener(\"appinstalled\", (e) => {\r\n      console.log(\"PWA was installed\");\r\n      installButton.classList.remove(\"show\");\r\n\r\n      // Show success notification\r\n      if (\"Notification\" in window && Notification.permission === \"granted\") {\r\n        new Notification(\"App Installed!\", {\r\n          body: \"Dicoding Story App has been installed successfully\",\r\n          icon: \"/icons/icon-144x144.svg\",\r\n          badge: \"/icons/icon-144x144.svg\",\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add PWA install status checking\r\n  checkPWAInstallStatus() {\r\n    // Check if app is running as PWA\r\n    if (window.matchMedia(\"(display-mode: standalone)\").matches) {\r\n      console.log(\"App is running as PWA\");\r\n      document.body.classList.add(\"pwa-mode\");\r\n    }\r\n\r\n    // Check if app can be installed\r\n    if (\"serviceWorker\" in navigator && \"BeforeInstallPromptEvent\" in window) {\r\n      console.log(\"PWA install capability available\");\r\n    }\r\n  }\r\n\r\n  // Show sync status\r\n  showSyncStatus(message, isError = false) {\r\n    let statusElement = document.querySelector(\".sync-status\");\r\n    if (!statusElement) {\r\n      statusElement = document.createElement(\"div\");\r\n      statusElement.className = \"sync-status\";\r\n      document.body.appendChild(statusElement);\r\n    }\r\n\r\n    statusElement.textContent = message;\r\n    statusElement.className = `sync-status ${isError ? \"error\" : \"\"}`;\r\n    statusElement.classList.add(\"show\");\r\n\r\n    // Hide after 3 seconds\r\n    setTimeout(() => {\r\n      statusElement.classList.remove(\"show\");\r\n    }, 3000);\r\n  }\r\n}\r\n\r\n// Initialize application when DOM is fully loaded\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  try {\r\n    window.app = new App();\r\n    console.log(\"Application initialized successfully\");\r\n  } catch (error) {\r\n    console.error(\"Failed to initialize application:\", error);\r\n    document.getElementById(\"app-container\").innerHTML = `\r\n      <div class=\"container\">\r\n        <div class=\"alert alert-danger\">\r\n          <h2><i class=\"fas fa-exclamation-triangle\"></i> Application Error</h2>\r\n          <p>Failed to initialize the application. Please try refreshing the page.</p>\r\n          <p>Error details: ${error.message}</p>\r\n          <button onclick=\"window.location.reload()\" class=\"btn\">Reload Page</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n});\r\n"],"file":"assets/main-C5JAmAhH.js"}